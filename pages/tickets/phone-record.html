<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>充值记录</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/jquery.min.js"></script> 
		
		<style type="text/css">
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px; 
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{
				color: #fff;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-icon{
				line-height: 50px;
			}	
			.mui-icon .iconfont{
				font-size: 18px;
			}
			.dealcard, .cinemacard{
				margin-top: 50px;
			}
			#main{
				margin-top: 50px;
			}
			.farm .bottom ul li{
				text-overflow: ellipsis;
				white-space: nowrap;
				overflow: hidden;
				display: block;
				width: 100%;
			}
			.fr{
				color: #fff !important;
				line-height: 50px;
			}
			.rentingtop{
				background-color: #fff;
			}
			.icon{
				display: inline-block;
				width: 40px;
				height: 40px;
				border-radius: 50%;
				margin: 10px 0;
				float: left;
			}
			.icon-gas{
				background-color: #006699;
			}
			.icon-water{ 
				background-color: #006699;
			}
			.icon img{
				margin: 8px;
				width: 25px;
				margin-top: -4px;
			}
			.chargeTitle{
				display: inline-block;
				font-size: 18px !important;
				line-height: 80px !important;
				margin-left: 5%;
			}
			.recharge .czhi,.btw{
				padding: 0 15px;
				margin: 0;
			}
			.clearfloat{
				border-bottom: 1px solid #eee;
				/*margin-bottom: 10px;*/
			}
			.farm, .farmtc{
				background-color: #fafafa;
			}
			.farm .top, .farm .bottom{
				border-bottom: 1px solid #eee !important;
			}
			.warpthree{
				border-top: 1px solid #eee;
			}
			.line{
				margin-bottom: 0;
				border-bottom: none;
			}
			.btw p{
				font-size: 13px;
				line-height: 15px;
				margin-top: -10px;
			}
			.agree p{
				color: #666;
				padding-top: 30px;
				font-size: 15px !important;
			}
			.textRed{
				color: #f56267;
			}
			button{
				margin: 50px 10%;
				width: 80% !important;
				line-height: 18px !important;
				background-color: #f53c42 !important; 
				color: #fff !important;
				border: none !important;
			}
			.mui-icon-arrowright{
				color: #999 !important;
			}
			
			.recharge .czhi p, .recharge .czhi span{
				line-height: 60px;
				color: #999;
			}
			.recharge .czhi, .btw {
				height: 60px;
				/*border-bottom: 1px solid #eee;*/
			}
			.recordDetail{
				width: calc(100vw - 70px);
				display: inline-block;
				padding: 10px 20px;
			}
			.recordDetail p{
				width: 100% !important;
				display: inline-block;
				line-height: 20px !important;
			}
			.recordBig{
				font-size: 20px !important;
				color: #666 !important;
			}
			.recordTiny{
				font-size: 12px !important;
			}
			
		</style>
	</head>
	<body class="farm">
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">充值记录</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--详情内容-->
		<div id="main">
			<div class="deal"> 
				<div>
					<div class="warpthree clearfloat line">
						
						<div id="rechargeList"></div>
						<script type="text/html" id="rechargeTpl">
							<%if(list.length !=0){%>
							<%for(var t=list.length-1;t>=0;t--){%> 
									<div class="recharge clearfloat" onclick="recordDe('<%=list[t].uuid%>')"> <!-- onclick="recordDe('<%=list[t].uuid%>')"-->
									<div class="recharge clearfloat">  
							    		<div class="czhi box-s">
												<div class="icon-water icon">
													<img src="../../img/tickets/phone.png"/>
												</div>
												<div class="recordDetail">
													<p class="recordBig">
														-<%=list[t].payment_data.advicePrice%>
														<em style="font-size: 0.12rem;" class="mui-pull-right"><%=list[t].create_time%></em> 
													</p>
													<p class="recordTiny">话费充值<%=list[t].payment_data.name%>元</p>
												</div> 
							    		</div>
							    	</div>	
									 
								<%}%>
								<%}else{%>
									<img src="../../img/tickets/noorder.svg" style="margin: auto;display: block;width: 1rem;margin-top:1rem ;" alt="" /><span style="display:block;text-align: center;padding: 20px;">没有记录</span>
								<%}%>
						</script> 
				    	
				   </div>
				</div>
			</div>
		</div>
	</body>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function recordDe(id){
			openview({
				view:'phone-record-de.html',
				extrasobj:{qianmiOrderID:id}
			})
		} 
		mui.plusReady(function(){
			var oldToken = plus.storage.getItem('oldToken');
			var myuserid = plus.storage.getItem('userid');
		 	
		 	 
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			mui.ajax(serverUrl+'/api/banma/billorder',{
				data:{userid:myuserid,type:1},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken},	 
				success:function(data,type,xhr){
					console.log('充值记录',data)
					plus.nativeUI.closeWaiting()
					if(data.errno==0){
						 if(data.data.length!=0){ 
						 	var rcObj = {};
						 	var objdata = [];
						 	for(var t=0;t<data.data.length;t++){ 
//						 		if(data.data[t].state == 1){ 
						 			var dt = new Date(data.data[t].create_time);
									var date = [
									  [dt.getFullYear(), dt.getMonth() + 1, dt.getDate()].join('-')].join(' ').replace(/(?=\b\d\b)/g, '0'); // 正则补零
									data.data[t].create_time = date;
						 			data.data[t].payment_data = JSON.parse(data.data[t].payment_data); 
						 			console.log(data)
						 			 
						 			if(data.data[t].state == 1 && data.data[t].payment_data.originalPrice){
						 				data.data[t].payment_data.advicePrice = parseFloat(data.data[t].payment_data.advicePrice).toFixed(2);
						 				data.data[t].payment_data.originalPrice = parseFloat(data.data[t].payment_data.originalPrice).toFixed(2);
						 				objdata.push(data.data[t])
						 			}
						 }   
						 	rcObj.list = objdata; 
						 	console.log('objdata',rcObj.list)
						 	mui("#rechargeList")[0].innerHTML = template("rechargeTpl",rcObj);
						 	
						 }else{
						 	mui("#rechargeList")[0].innerHTML = '<img src="../../img/tickets/noorder.svg" style="margin: auto;display: block;width: 1rem;margin-top:1rem ;" alt="" /><span style="display:block;text-align: center;padding: 20px;">没有记录</span>';
						 }
					}
				},
				error:function(xhr,type,errorThrown){
				}
			}); 
		})
			 
	</script>
</html>