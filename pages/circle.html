<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>HI友圈</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/common.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.css"/>
		<link rel="stylesheet" type="text/css" href="../css/config.css"/>
		<script src="../js/mui.min.js"></script>
	</head>
	<style type="text/css">
		.felsr{display: flex;justify-content: space-around;align-items: center;background-color: white;padding: 10px 0;text-align: center;position: relative;}
		.felsr:after{position:absolute;content:'';height:1px;left:10px;right:10px;-webkit-transform:scaleY(.3);background:#CACACA;bottom:0}
		.felsr img{width: 40px;display: block;margin: auto;}
		.todayHOt{padding: 10px;}
		.ftr{display: flex;justify-content: space-between;align-items: center;}
		.ftr img{width: 10px;}
		.hiFriend .bigPic{display: block;}
		.avaPic{width: 20px;height:20px;border-radius: 30px;vertical-align: middle;}
		.footFirend{height:26px;line-height: 28px;color: #666;font-size: 13px;}
		.lovePic{width: 18px;height:16px;float: right;margin-top: 6px;}
		.hiFriend{padding: 5px;}
		.paddDiv{padding: 5px;}
		.bigPic{width: 6em;height: 6em;border-radius: 3px;}
		.mui-row{padding-top: 5px;}
		.QAhead{background-color:#f3f3f3;text-align:center;}
		.QAhead span{position:relative;display:inline-block;height:42px;color:#343434;font-size:15px;line-height:42px;width: 22%;}
		.QAhead span.active{color:#f93a38}
		.QAhead span:after{position:absolute;bottom:0;left:50%;width:0;height:1px;background-color:#f31414;content:""}
		.QAhead span.active:after{left:0!important;width:100%!important;transition:all .3s}
		.listCon{border-bottom: 15px solid #F3F3F3;}
		.listCon p{padding:10px 0 0}
		.follow{position:relative;}
		.follow{background-color:#fff;padding:15px 10px;}
		.follow:after{position:absolute;right:5px;bottom:0;left:5px;height:1px;background:#cacaca;content:'';-webkit-transform:scaleY(.3);}
		.follow:last-child:after{height:0;}
		.fchidl{display:flex;align-items:center;justify-content:space-between;}
		.Avator,.userAvator{margin-right:15px;width:2.5rem;height:2.5rem;}
		.userAvator{border-radius:50%;}
		.fchidl>div{display:flex;vertical-align:middle;text-align:left;font-size:15px;align-items:center;justify-content: flex-end;}
		.text{color:#999;}
  		.flexrr{display: flex;justify-content: space-around;align-items: center;padding: 10px 0;}
  		.flexrr>div img{width: 25px;vertical-align: middle;}
  		.cmtall img{width: 25px;margin-right: 5px;}
  		.cmtflex{display: flex;justify-content: space-between;align-items: center;}
  		.ctc{font-size: 12px!important;}
  		.ctc span{color: #fb7e23;}
  		.jubao{background-color: white;bottom: 0!important;position: absolute;right: 0;left: 0;}
		.jubao li a{padding: 18px;line-height: 15px;text-align: center;border-bottom: 1px solid #EEEEEE;display: block;color: black;}
		.jubao li:last-child a{color: rgb(153,153,153);}
		/*.QandA{min-height: 720px;}*/
		#upload{min-height: auto !important;padding-top: 5px;height: 37px;}
		#upload img{padding: 0 !important;margin: 0;width: 32px;}
		body{padding-bottom: 0;}
		.loadPics{max-width: 80%;}
		.DTcontent{overflow: hidden;}
		.dynamicPic{float: left;position: relative;overflow: hidden;border-right: 2px solid #fff;}
		.dynamicPic1{width: 70%;padding-top: 68%;}
		.dynamicPic2{width: 50%;padding-top: 48%;}
		.dynamicPic3{width: 33%;padding-top: 31%;}
		.dynamicPic img{width: 100%;}
		.dynamicPic span{display: inline-block;position: absolute;top: 2%;left: 2%;width: 96%;height: 96%;background-color: #F3F3F3;overflow: hidden;}
		.line2{text-overflow: ellipsis;overflow: hidden;white-space: nowrap;max-width: calc(100vw * 0.45);max-width: -webkit-calc(100vw * 0.45);max-width: -moz-calc(100vw * 0.45);}
		.maxwn{white-space: nowrap;}
		.maxwt{flex-basis: 50px;white-space: nowrap;text-align: right;}
		#maskInfo{z-index:99999;position:fixed;top:0;left:0;width:100%;bottom:0;background-color:rgba(0,0,0,.5)}
	 	.hiFdW{width: calc((100vw - 40px) / 3);width: -webkit-calc((100vw - 40px) / 3);width: -moz-calc((100vw - 40px) / 3);height: -moz-calc((100vw - 40px) / 3);height: -webkit-calc((100vw - 40px) / 3);height: calc((100vw - 40px) / 3);background: #f3f3f3;border-radius: 3px;overflow: hidden;}
		.hiFdW img{width: 100%;}
		.ruleCt2{position:absolute;padding-right:15px;background-color:#fff;top:24%;left:17%;width:66%;bottom:24%;padding:15px 5px;border-radius:3px}
		.closeMs2{position: absolute;top:25%;width: 20px;height: 20px;right: 19%;z-index: 99999;}
		#mmsg{position: absolute;top: 10px;right: -5px;background: #f34f47;color: #fff;font-size: 10px;padding: 2px 4px;}
	</style>
	<body style="background-color: white;">
		<header class="mui-bar mui-bar-nav" style="z-index: 11;">
		    	<img class="mui-pull-left friendCenter"  src="../img/makeFriend/userCenter.png" style="width:20px;margin-top: 15px; margin-left: 15px;"/>
		    <h1 class="mui-title">HI友圈</h1>
			<div class="mui-pull-right xiaoxi" style="position: relative;margin-right: 10px;">
		    		<img src="../img/makeFriend/message.png" style="width:27px;margin-top: 13px;"/>
		    		<span id="mmsg" class="mui-badge mui-badge-danger" style="display:none;"></span>
		    </div>

		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<!--分类-->
		<div class="felsr ft12" style="position: fixed;top: 70px;left: 0;right: 0;height: 80px;z-index: 10;">
			<div class="goFeriend">
				<img src="../img/makeFriend/friend.png"/>
				<span>交友</span>
			</div>
			<div class="goCircle">
				<img src="../img/makeFriend/circle.png"/>
				<span>圈子</span>
			</div>
			<div class="goAround">
				<img src="../img/makeFriend/around.png"/>
				<span>附近</span>
			</div>
			<div class="goHot">
				<img src="../img/makeFriend/hotborad.png"/>
				<span>人气榜</span>
			</div>
		</div>
		<div id="main" style="margin-top: 100px;">
			<!--今日热门-->
			<div class="todayHOt" style="background-color: white;">
				<div class="ftr" id="todayHOt">
					<span class="ft14">今日热门</span>
					<img src="../img/localLife/righticon.png"/>
				</div>
				<div id="circleContain">
					<div class="mui-row">
						<div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
				            <div class="hiFdW">
				            </div>
				        </div>
				        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
				            <div class="hiFdW">
				            </div>
				        </div>
				        <div class="mui-col-sm-4 mui-col-xs-4 paddDiv">
				            <div class="hiFdW">
				            </div>
				        </div>
			       </div>
				</div>
			    <script type="text/html" id="listDataH">
			    	<div class="mui-row">
						<%for(var i=0;i<dataList.length;i++){%>
							<div class="mui-col-sm-4 mui-col-xs-4 paddDiv" onclick="elseCircleIndex(<%=dataList[i].user_id%>)">
					            <div class="hiFdW">
					            	<%if(dataList[i].picS){%>
					            		<img class=" loadPics picOp" onload="imgHeight(this)" data-src="<%=dataList[i].picS[0]%>"/>
					            	<%}else{%>
					            		<img class=" loadPics picOp" onload="imgHeight(this)" data-src="<%=dataList[i].avatar%>"/>
					            	<%}%>
					            </div>
					            <p class="footFirend">
					            <!--<img class="avaPic loadPics picOp" data-src="<%=dataList[i].avatar%>" />-->
					            	<%=dataList[i].nickname%>
					            	<%if(dataList[i].isfriend){%>
					            		<img class="lovePic" src="../img/mainHtml/yizan.png"/>
					            	<%}else{%>
					            		<img class="lovePic" src="../img/mainHtml/weizan.png"/>
					            	<%}%>
					            </p>
					        </div>
						<%}%>
				    </div>
			    </script>
			</div>
			<!--今日热门结束-->

			<!--动态-->
			<div class="QandA">
				<div class="QAhead" style="position: -webkit-sticky; position:sticky; top: 150px;z-index: 9;display: block;width: 100%;">
					<span class="active aClick">最新动态</span>
					<span class="aClick">好友动态</span>
					<span class="aClick">今日热门</span>
					<span class="aClick">七天热门</span>
				</div>

				<div class="dyCon" id="dyCon0" style="display: none;"></div><!--最新动态-->
				<div class="dyCon" id="dyCon1" style="display: none;"></div><!--好友动态-->
				<div class="dyCon" id="dyCon2" style="display: none;"></div><!--今日热门-->
				<div class="dyCon" id="dyCon3" style="display: none;"></div><!--七天热门-->

				<script type="text/html" id="listDataS">
					<%for(var i=0;i<dataList.length;i++){%>
						<%if(dataList[i].user_id && dataList[i].user_id != 'null' && dataList[i].id){%>
							<div class="listCon" onclick="DTdetail(<%=dataList[i].id%>,<%=dataList[i].user_id%>)">
								<div class="follow">
									<div class="fchidl">
										<div onclick="elseCircleIndex(<%=dataList[i].user_id%>)">
											<img data-src="<%=dataList[i].avatar%>" src="../img/morentouxiang.jpg" class="userAvator mr25 loadPics"/>
											<div>
												<%=dataList[i].nickname%> <div class="disablecl ft12"> <%=dataList[i].create_time%>  <span style="color: #5d86b2;"><%=dataList[i].read%></span>阅读 </div>
											</div>
										</div>
										<div class="butright">
											<div class="goanswer" style="font-size: 13px;color: #666;" data-id="<%=dataList[i].id%>" data-userId="<%=dataList[i].user_id%>"> 举报 <img src="../img/makeFriend/down.png" style="width:15px;"/> </div>
							            </div>
									</div>
									<div class="DTcontent">
										<p class="ft14 maincl overTwo linkMore01"  style="-webkit-user-select: text;"><%=dataList[i].content%> </p><!--文字内容-->
										<%if(dataList[i].picS){%>
											<%for(var j=0;j<dataList[i].picS.length;j++){%>
												<%if(dataList[i].picS.length == 1){ %>
													<div class="dynamicPic dynamicPic1">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" data-preview-src="" data-preview-group="<%=i%>"/></span>
													</div>
												<%}else if(dataList[i].picS.length == 2){%>
													<div class="dynamicPic dynamicPic2">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" data-preview-src="" data-preview-group="<%=i%>"/></span>
													</div>
												<%}else{%>
													<div class="dynamicPic dynamicPic3">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" data-preview-src="" data-preview-group="<%=i%>"/></span>
													</div>
												<%}%>
											<%}%>
										<%}%>

									</div>
									<div class="flexrr">
										<div class="disablecl ft12" >
											<%if(dataList[i].likeUserId){%>
												<img src="../img/makeFriend/yizan.png" onclick="goZan(this,<%=dataList[i].id%>,<%=dataList[i].user_id%>)"/>
												<%}else{%>
													<img src="../img/makeFriend/zan.png" onclick="goZan(this,<%=dataList[i].id%>,<%=dataList[i].user_id%>)"/>
													<%}%>

											 赞<span><%=dataList[i].likes%></span> </div>
										<div class="disablecl ft12" onclick="goInfoCmt(<%=dataList[i].id%>,<%=dataList[i].user_id%>,'')"> <img src="../img/makeFriend/message.png" alt="" /> 评论 </div>
										<%if(dataList[i].picS){%>
											<div class="disablecl ft12" onclick="Forwarding('<%=dataList[i].content%>','<%=dataList[i].id%>','<%=dataList[i].user_id%>','<%= dataList[i].picS[0]%>')"> <img src="../img/makeFriend/share.png"/> 转发 </div>
										<%}else{%>
											<div class="disablecl ft12" onclick="Forwarding('<%=dataList[i].content%>','<%=dataList[i].id%>','<%=dataList[i].user_id%>','')"> <img src="../img/makeFriend/share.png"/> 转发 </div>
										<%}%>

									</div>

									<div class="commentsShow" data-id="<%=dataList[i].id%>"></div>

								</div>
							</div>
							<%}%>

					<%}%>
				</script>

				<!--评论模板-->
				<script type="text/html" id="cmtTpl">
					<div class="cmtflex" style="border-top:1px solid #DDDDDD ;border-bottom: 1px solid #DDDDDD;padding: 10px 5px;"><!--评论-->
						<div style="text-align: center;line-height: 0.8;">
							<div class="ft14">评论</div>
							<img style="width: 30px;margin: 0;" src="../img/makeFriend/cmt.png"/>
						</div>
						<div class="cmtflex cmtall ft12">
							<img src="../img/makeFriend/more.png"/>
							评论<%=allL%>
						</div>
					</div>
					<%for(var i=0;i<list.length;i++){%>
						<%if(!list[i].commontid){%>
							<div class="follow ft12" style="padding: 5px;">
								<div class="fchidl">
									<div class="ctc" onclick="goInfoCmt(<%=list[i].newsId%>,<%=list[i].userid%>,<%=list[i].id%>)"> <span data-id="<%=list[i].user_id%>" class="ft12 maxwn"><%=list[i].nickname%></span>：<div class="line2"><%=list[i].commont%></div></div>
									<div class="butright maxwt"> <div class="disablecl ft12"> <%=list[i].create_time%> </div> </div>
								</div>
							</div>
							<%}else{%>
								<div class="follow ft12" style="padding: 5px;">
									<div class="fchidl">
										<div class="ctc" onclick="goInfoCmt(<%=list[i].newsId%>,<%=list[i].userid%>,<%=list[i].id%>)"> <span data-id="<%=list[i].user_id%>" class="ft12 maxwn"><%=list[i].nickname%></span>回复<span data-id="<%=list[i].touserid%>" class="ft12"><%=list[i].TO_nickname%></span>:<div class="line2"><%=list[i].commont%></div></div>
										<div class="butright maxwt"> <div class="disablecl ft12"> <%=list[i].create_time%> </div> </div>
									</div>
								</div>
								<%}%>
						<%}%>


				</script>
				<div class="upload text-center text-xs gray" id="upload"><img src='../img/balls.svg' /></div>
			</div>
			<!--动态结束-->


			<!--操作表-->
			<div id="maskInfo" style="display: none;">
			    <!-- 可选择菜单 -->
			    <ul class="jubao">
			      <li>
			        <a href="javascript:;" onclick="doJubao()">加入黑名单</a>
			      </li>
			      <li>
			        <a href="javascript:;" onclick="doJubao()">举报</a>
			      </li>
			      <li>
			        <a href="javscript:;" class="closeMask" >取消</a>
			      </li>
			    </ul>
			</div>

			<!--发布-->
			<style type="text/css">
				.fabu1{position: fixed;bottom: 15px;right: 12px;width: 50px;height: 50px;background-color: #fff;border-radius: 50%;opacity: 1;}
				.fabu2{position: fixed;bottom: 40px;right: 37px;width: 0px;height: 0px;background-color: #fff;border-radius: 50%;opacity: 0;}
				#fabu img{width: 100%;height: 100%;}
				#fabu{transition: opacity .5s;}
			</style>
			<div id="fabu" class="fabu1">
				<img src="../img/makeFriend/fabu.svg"/>
			</div>

			<!--遮罩1-->
			<div id="maskInfo1" class="maskInfo" style="display: none;z-index:9999;"></div>
			<script type="text/html" id="maskTpl">

				<img src="../img/mainHtml/mclose.svg" class="closeMs"/>
				<div class="ruleCt" style="padding-bottom: 50px;padding: 0;">

				<%if(popdata.modelContent){%>
					<img src="<%=popdata.modelContent%>" style="border-radius: 3px;width: 100%;height: 100%;" onclick="popGo('<%=popdata.id%>','<%=popdata.modelUrl%>','<%=popdata.name%>','one')"/>
				<%}else{%>
					<img src="../img/mainHtml/mask2.png" />
				<%}%>
				</div>
			</script>
			<!--双旦活动-->
			<!--<div id="shaungdan0" class="maskInfo" style="display: none;z-index:9999;">
				<img src="../img/mainHtml/mclose.svg" class="closeMs closeMs2"/ style="width: 35px;height: 35px;">
				<div class="ruleCt ruleCt2" id="shaungdan1" style="padding-bottom: 50px;padding: 0;">
					<img class="SDonePic" src="../img/shuangdan/shendanfa.png" style="border-radius: 3px;width: 100%;height: 100%;display: none;"/>
					<img class="SDonePic" src="../img/shuangdan/yuandanfa.png" style="border-radius: 3px;width: 100%;height: 100%;display: none;"/>
				</div>
			</div>-->
			<!--年货节发帖送好礼，类似双旦节-->
			<div id="maskInfo123" class="maskInfo" style="display: none;z-index:999;">
				<div class="ruleCt" style="padding-bottom: 50px;padding: 0;background: none;top: 29%;bottom: auto;">
					<img id="fenxiangBtn2" src="../img/limitTimeAct/22nianhuofatie/01-min.png" style="border-radius: 3px;width: 100%;height: 100%;" />
					<img src="../img/limitTimeAct/19OrderShare/02_03.png" class="closeMs23" style="display: block;margin: 0 auto;width: 12%;"/>
				</div>
			</div>
			<script src="../js/shuangdan.js"></script>
			<!--双旦活动结束-->

		</div>
		<script type="text/javascript" src="../js/jquery.min.js"></script>

		<script src="../js/app.js"></script>
		<script src="../js/mui.zoom.js"></script>
		<script src="../js/mui.previewimage.js"></script>
		<script src="../js/artTemplate-native.js"></script>
		<script type="text/javascript">
			openMask();//年货节发帖送好礼关闭方法
			//转发
			function Forwarding(title,infiId,newsUserId,pic){
				event.stopPropagation();
				var msg = {
					myIsIndex:true,
					title:title,
					content:title,
					href:fxUrl+'socialCircle/circleListInfo.html?infoid='+infiId+'&UserId='+newsUserId,
					thumbs:[pic],
					pictures:[pic]

				};
				showSfun1(msg);
			}
			//链接条状
			function openUrlFun(that){
				var openUrl = $(that).find('b').html();
				event.stopPropagation();
				openview({
					view:'socialCircle/linkurl.html',
					id: "linkurl",
					extrasobj: {
						bannerUrl:openUrl
					}
				})
			}

		</script>
		<script type="text/javascript">
			mui.init();
			$('.ruleCt').click(function(){
				event.stopPropagation()
			})
			function refreshFun(){
				shopData(0,0,false);//默认推荐
			}
			mui.plusReady(function(){
				downRe(refreshFun);
			})
			mui.plusReady(function(){
				//我的消息
				mui('.xiaoxi')[0].addEventListener('tap',function(){
					if(plus.storage.getItem('myToken')){
						openview({
							view:'personal/friendMessage.html',
							id:'friendMessage'
						});
					}else{//没登陆直接打开登录页面
						mui.toast('请登录');
						openview({
							view:'login.html'
						});
					}
				});
			    var version = plus.storage.getItem('version');
				var platform  = plus.storage.getItem('platform');
				/*弹框*/
				mui.ajax(serverUrl + '/api/index/showmodal', {
					data:{version:version,platform:platform},
	                type: 'post',
	                timeout: 10000,
	                headers: { "token": plus.storage.getItem('oldToken') ,'city':plus.storage.getItem('cityNum')},
	                success: function(data, type, xhr) {
	                   	plus.nativeUI.closeWaiting();
	                		console.log('弹窗',data)
	                		if(data.errno == 0){
	                			if(data.data && data.data.length){
	                				mui.each(data.data,function(index,item){
		                				if(item.typeName == 'friendIndex'){
		                					if(item.modelState == 1){
	                            			 	$('#maskInfo1').show();
	                            			 	$('#maskInfo1').html(template('maskTpl',{popdata:item}))
	                            			 	$('#maskInfo1').click(function(){
												event.preventDefault()
												$('#maskInfo1').fadeOut(200);
											})
											$('.closeMs').click(function(){
												event.stopPropagation();
												$(this).parent().fadeOut(200);
											})
	                            			}else{
	                            			 	$('#maskInfo1').hide()
	                            			}
		                				}
                            		})
	                			}
	                		}
	                },
	                error: function(xhr, type, errorThrown) {
	                		console.log('首页弹窗',type)
	                    console.log('响应失败');
	                   	plus.nativeUI.closeWaiting();
	                }
	            });

	            window.goInfoCmt = function(id,userid,cmtid){
	            		event.stopPropagation();
	 				if(plus.storage.getItem('myToken')){
						var cityNum = plus.storage.getItem('cityNum');
						var myuserid = plus.storage.getItem('userid');
						var oldToken = plus.storage.getItem('oldToken');
						mui.prompt('null','请输入评论','评论',['确认','取消'],function(e) {
							if(e.index == 0) {
								if(e.value && e.value!=' '){
									var commont = e.value;
					    			mui.ajax(serverUrl + '/api/friends/newscomment', {
					    					data:{newsId:id,userid:myuserid,touserid:userid,commont:commont,commontid:cmtid},
										dataType: 'json',
										type: 'POST',
										timeout: 8000,
										headers: {"token": oldToken,'city': cityNum},
										success: function(data, type, xhr) {
											console.error('评论详情', data);

											if(data.errno == 0) {
								    			mui.toast('评论成功');
											shopData(0,0,false);//默认推荐

											}else{
												mui.toast('当前网络不好,请重试');
											}
										},
										error: function(xhr, type, errorThrown) {
											console.error('评论,响应失败');
											mui.toast('当前网络不好,请重试');
										}
									});
								}else{
									mui.toast('评论失败')
								}
							}
						},'')
					}else{
						mui.toast('请登录');
						openview({
							view:'login.html'
						});
					}
	 			}
			})



			/*动态tab切换*/
			var flag0 = 0,flag1 = 0,flag2 = 0,flag3 = 0,//是否   第一次点击
		     	SH0 = 0,SH1 = 0,SH2 = 0,SH3 = 0;/*保存的状态栏高度*/
			var listCon = document.getElementsByClassName('QAhead')[0].getElementsByTagName('span');/*按钮*/
			var dyCon = document.getElementsByClassName('dyCon'); /*内容盒子*/
			[].forEach.call(listCon,function(ele,index){
				ele.onclick = function(){
					if(!ele.className.indexOf('active')>-1){
						[].forEach.call(listCon,function(ele2){
							ele2.className = '';
						})
						ele.className = 'active aClick';

						[].forEach.call(dyCon,function(ele3){
							ele3.style.display = 'none';
						})
						dyCon[index].style.display = 'block';

						if(index == 0){
							if(flag0==0){
								shopData(index,0);
							}else{
								$(window).scrollTop(SH0);
							}
						}else if(index == 1){
							if(plus.storage.getItem('myToken')){
								if(flag1==0){
									shopData(index,1);
								}else{
									$(window).scrollTop(SH1);
								}
							}else{
								mui.toast('请登录');
								openview({
									view:'login.html'
								});
							}

						}else if(index == 2){
							if(flag2==0){
								shopData(index,2);
							}else{
								$(window).scrollTop(SH2);
							}
						}else if(index == 3){
							if(flag3==0){
								shopData(index,3);
							}else{
								$(window).scrollTop(SH3);
							}
						}
					}else{//点击active项    就刷新
						$(window).scrollTop(280);
						if(index == 0){
							flag0 = 0,SH0 = 0;
							shopData(index,0,true);
						}else if(index == 1){
							flag01 = 0,SH1 = 0;
							shopData(index,1,true);
						}else if(index == 2){
							flag01 = 0,SH1 = 0;
							shopData(index,2,true);
						}else if(index ==3){
							flag01 = 0,SH1 = 0;
							shopData(index,3,true);
						}
					}
				}
			})
			document.addEventListener('refresh', function() {
				[].forEach.call(listCon,function(ele2){
					ele2.className = '';
				})
				listCon[0].className = 'active aClick';

				[].forEach.call(dyCon,function(ele3){
					ele3.style.display = 'none';
				})
				dyCon[0].style.display = 'block';
				shopData(0,0,false);//默认推荐
			})

			/*打开主页,包括判断 他人 或 个人 主页*/
			window.openDetail = function(id){
				event.stopPropagation();
				mui.plusReady(function(){
					var myuserid = plus.storage.getItem('userid');
					if(plus.storage.getItem('myToken')){
					if(id == myuserid){
						openview({
				    		view:'socialCircle/mycircleIndex.html',
				    		id:'mycircleIndex'
				    	})
						}else{
							openview({
					    		view:'socialCircle/elsecircleIndex.html',
					    		id:'elsecircleIndex',
					    		extrasobj:{userId:id}
					    	})
						}
					}else{
						mui.toast('请登录');
						openview({
							view:'login.html'
						});
					}
				})
		    }
			/*铺数据*/
			/*循环加载token*/
			mui.plusReady(function(){
				var Timetoken = null;
				var oldToken = null;
				document.addEventListener('refreshC', function() {
					showMessage();
				})
				if(plus.storage.getItem('oldToken')){
					oldToken = plus.storage.getItem('oldToken');
					console.log('hi友圈_存在oldToken');

					todayHot();
					shopData(0,0,false);//默认推荐
				}else{
					clearInterval(Timetoken);
					Timetoken = setInterval(function() { //等待oldToken加载方法
						console.log('hi友圈_循环等待token');
						if(plus.storage.getItem('oldToken')) {
							clearInterval(Timetoken);
							oldToken = plus.storage.getItem('oldToken');

							todayHot();
							shopData(0,0,false);//默认推荐
						}
					}, 200)
				}
				if(plus.storage.getItem('myToken')){
					showMessage()
				}

				function showMessage(){

					var myuserid = plus.storage.getItem('userid');
					//显示消息条数
					mui.ajax(serverUrl+'/api/index/message',{
						data:{userid:myuserid,msgType:2},
						dataType:'json',
						type:'post',
						timeout:10000,
						headers:{"token":oldToken},
						success:function(data,type,xhr){
							plus.nativeUI.closeWaiting();
							console.log('消息hi',data);
					       	if(data.errno == 0){
						       	if(data.data && data.data.length){
						       		var noread = 0 ;
						       		for(var i =0;i<data.data.length;i++){
						       			if(!data.data[i].isRead){
						       				noread++;
						       			}
						       		}
						       		if(noread > 0){
						       			mui('#mmsg')[0].style.display = 'block';
					     				mui('#mmsg')[0].innerHTML = noread;
						       		}else{
						       			mui('#mmsg')[0].style.display = 'none';
						       		}
//
								}
					       	}
					       	plus.nativeUI.closeWaiting();
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting();
						}
					});
				}

			})

			dyCon[0].style.display = 'block';
			//今日热门
			function todayHot(){
				mui.plusReady(function(){
					var cityNum = plus.storage.getItem('cityNum');
					var oldToken = plus.storage.getItem('oldToken');
					var myuserid = plus.storage.getItem('userid');
					window.elseCircleIndex = function(id){
						event.stopPropagation();
						if(plus.storage.getItem('myToken')){
							if(id == myuserid){
								openview({
						    		view:'socialCircle/mycircleIndex.html',
						    		id:'mycircleIndex'
						    	})
							}else{
								openview({
						    		view:'socialCircle/elsecircleIndex.html',
						    		id:'elsecircleIndex',
						    		extrasobj:{userId:id}
						    	})
							}
						}else{
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
				    }
					mui.ajax(serverUrl+'/api/friends/hot', {
						data:{numsPerPage:3,time:24},
						dataType: 'json',
						type: 'post',
						timeout: 8000,
						headers: {"token": oldToken,'city': cityNum},
						success: function(data, type, xhr) {
							console.log('热门 ',data);
							if(data.errno == 0) {
								if(data.data && data.data.length){
									var dataObj = {};
									var arrData = [];
									if(data.data.length > 3){
										for(var i = 0 ;i<3;i++){
											if(data.data[i].nickname && data.data[i].nickname !='null'){
												if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(data.data[i].nickname)){
													data.data[i].nickname = data.data[i].nickname.substring(0,3)+"****"+data.data[i].nickname.substring(7,11)
												}
											}else{
												data.data[i].nickname = '匿名'
											}
											if(data.data[i].avatar){//整理头像格式
												if(data.data[i].avatar.indexOf("[")>-1){
													if(data.data[i].avatar.indexOf('http')>-1){
														data.data[i].avatar =  JSON.parse(data.data[i].avatar)[0].picImg;
													}else{
														data.data[i].avatar = serverimgUrl + JSON.parse(data.data[i].avatar)[0].picImg;
													}
												}
											}else{
												data.data[i].avatar = '../img/morentouxiang.jpg';
											}

										 	if(data.data[i].photo && data.data[i].photo.length){//整理内容图片格式
										 		var nowArray2 = data.data[i].photo;
										 		var picS = [];
										 		for(var k = 0 ;k<nowArray2.length;k++){
										 			if(nowArray2[k].picImg.indexOf('picImg')>-1){
										 				picS.push(JSON.parse(nowArray2[k].picImg)[0].picImg);
										 			}
												}
										 		data.data[i].picS = picS;
										 	}
											arrData.push(data.data[i])
										}
									}else{
										for(var i = 0 ;i<data.data.length;i++){
											if(data.data[i].nickname && data.data[i].nickname !='null'){
												if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(data.data[i].nickname)){
													data.data[i].nickname = data.data[i].nickname.substring(0,3)+"****"+data.data[i].nickname.substring(7,11)
												}
											}else{
												data.data[i].nickname = '匿名'
											}
											if(data.data[i].avatar){//整理头像格式
												if(data.data[i].avatar.indexOf("[")>-1){
													if(data.data[i].avatar.indexOf('http')>-1){
														data.data[i].avatar =  JSON.parse(data.data[i].avatar)[0].picImg;
													}else{
														data.data[i].avatar = serverimgUrl + JSON.parse(data.data[i].avatar)[0].picImg;
													}
												}
											}else{
												data.data[i].avatar = '../img/morentouxiang.jpg';
											}

										 	if(data.data[i].photo && data.data[i].photo.length){//整理内容图片格式
										 		var nowArray2 = data.data[i].photo;
										 		var picS = [];
										 		for(var k = 0 ;k<nowArray2.length;k++){
										 			if(nowArray2[k].picImg.indexOf('picImg')>-1){
										 				picS.push(JSON.parse(nowArray2[k].picImg)[0].picImg);
										 			}
												}
										 		data.data[i].picS = picS;
										 	}
											arrData.push(data.data[i])

										}
									}

									dataObj.dataList = arrData;
									document.getElementById("circleContain").innerHTML = template("listDataH", dataObj);

									lazyLoad(true,10);//懒加载
								}else{
									document.getElementById("circleContain").innerHTML ='<div style="text-align: center;font-size: 13px;">暂无数据</div>';
								}

							}else{

							}
						},
						error: function(xhr, type, errorThrown) {
							console.error('交友列表,响应失败');
							//mui.toast('当前网络不好,请重试');
						}
					});
				})
			}

			/*动态列表*/
			function shopData(typeNum,gender,refresh){
				var Spagenum = 2; //实到页数
				var Ypagenum = 1; //应到页数
				if(refresh){
					document.getElementById('upload').innerHTML = "<img src='../img/balls.svg' />";
					document.getElementsByClassName("dyCon")[typeNum].innerHTML = '';
				}
				if(typeNum == 0){
					flag0++;
					if(flag0 == 2){
						$(window).scrollTop(280);
					}
				}else if(typeNum == 1){
					flag1++;
					if(flag1 == 1){
						$(window).scrollTop(280);
					}
				}else if(typeNum == 2){
					flag2++;
					if(flag2 == 1){
						$(window).scrollTop(280);
					}
				}else if(typeNum == 3){
					flag3++;
					if(flag3 == 1){
						$(window).scrollTop(280);
					}
				}
				mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
				mui.plusReady(function(){
					var myuserid = plus.storage.getItem('userid');
					//到主页
					window.elseCircleIndex = function(id){
						event.stopPropagation()
						if(plus.storage.getItem('myToken')){
							if(id == myuserid){
								openview({
						    		view:'socialCircle/mycircleIndex.html',
						    		id:'mycircleIndex'
						    	})
							}else{
								openview({
						    		view:'socialCircle/elsecircleIndex.html',
						    		id:'elsecircleIndex',
						    		extrasobj:{userId:id}
						    	})
							}
						}else{
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}
				    }

					window.goZan = function(obj,id,toUserId){
						event.stopPropagation()
						if(plus.storage.getItem('myToken')){
							var curThis = $(obj);

							if(curThis.attr('src') == '../img/makeFriend/zan.png'){
								likeThis(curThis,id,toUserId,cityNum,myuserid,oldToken,'POST','../img/makeFriend/yizan.png');
							}else{
								likeThis(curThis,id,toUserId,cityNum,myuserid,oldToken,'delete','../img/makeFriend/zan.png');
							}
						}else{
							mui.toast('请登录');
							openview({
								view:'login.html'
							});
						}

					}

					if(typeNum == 0){
						var dataJson = {
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'typeId':1
						}
					}else if(typeNum == 1){
						var dataJson = {
							'userId':myuserid,
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'isFriends':1,
							'typeId':1
						}
					}else if(typeNum == 2){
						var dataJson = {
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'smoneDays':1,
							'typeId':1
						}
					}else if(typeNum == 3){
						var dataJson = {
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'smoneDays':7,
							'typeId':1
						}
					}
					var cityNum = plus.storage.getItem('cityNum'),oldToken = plus.storage.getItem('oldToken');
					mui.ajax(serverUrl + '/api/friends/newslist', {
						data: dataJson,
						dataType: 'json',
						type: 'post',
						timeout: 10000,
						headers: {"token": oldToken,'city': cityNum},
						success: function(data, type, xhr) {
							console.log('交友列表'+typeNum, data);
							if(data.errno == 0) {
								var dataObj = {};
								if(typeNum == 2 || typeNum == 3){
									var nowArray = data.data;
								}else{
									var nowArray = data.data.data;
								}

								for(var j = 0 ;j<nowArray.length;j++){
									//整理头像格式
									if(nowArray[j].avatar && nowArray[j].avatar!='null'){
										if(JSON.parse(nowArray[j].avatar)[0].picImg.indexOf('http') == -1){
											nowArray[j].avatar = serverimgUrl + JSON.parse(nowArray[j].avatar)[0].picImg;
										}else{
											nowArray[j].avatar = JSON.parse(nowArray[j].avatar)[0].picImg
										}
									}else{
										nowArray[j].avatar = '../img/10.png'
									}

									if(nowArray[j].nickname && nowArray[j].nickname !='null'){
										if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(nowArray[j].nickname)){
											nowArray[j].nickname = nowArray[j].nickname.substring(0,3)+"****"+nowArray[j].nickname.substring(7,11)
										}
									}else{
										nowArray[j].nickname = '匿名'
									}

									if(!nowArray[j].read){
										nowArray[j].read = 0
									}else if((nowArray[j].read / 1000)>1){
										nowArray[j].read = parseInt(nowArray[j].read / 1000) +'K+'
									}
									if(!nowArray[j].likes || nowArray[j].likes<0){
										nowArray[j].likes = 0
									}
//									else if((nowArray[j].likes / 1000)>1){
//										nowArray[j].likes = parseInt(nowArray[j].likes / 1000) +'K+'
//									}
									var dt = new Date(nowArray[j].create_time).getTime();
									nowArray[j].create_time = getDateDiff(dt);
									//整理内容图片格式
 									var nowArray2 = JSON.parse(nowArray[j].pic);
									if(nowArray2.length){
										var picS = [];
										for(var k = 0 ;k<nowArray2.length;k++){
											picS.push(nowArray2[k].picImg);
										}
										nowArray[j].picS = picS;
									}
									/*整理 换行符*/
									function TransferString(content)
									{
									    var string = content;
									    try{
									        string=string.replace(/\r\n/g,"")
									        string=string.replace(/\n/g,"");
										} catch(e) {

										}
										return string;
										}

//
									nowArray[j].content = TransferString(nowArray[j].content)
//									nowArray[j].content = linkfilter(nowArray[j].content);
								}

								dataObj.dataList = nowArray;
								document.getElementsByClassName("dyCon")[typeNum].innerHTML = template("listDataS", dataObj);
								mui("#upload")[0].innerHTML = "";

								lazyLoad(true,-100);

								//加链接跳转（滚动加载下面也要加哦）
								function changUrl(){
									var linkMores = document.getElementsByClassName('linkMore01');
									for (var i = 0; i < linkMores.length; i++) {
										var textCon = linkMores[i].innerHTML;
										var urlRegExp = new RegExp("((https|http|ftp|rtsp|mms|www)?:\/*\/*)[^\u4E00-\u9FA5]+");
										if(urlRegExp.exec(textCon) != null){
											var urlReplace = urlRegExp.exec(textCon)[0];
											var endUrl = '<i style="color:#aa4848;text-decoration:underline;word-break: break-all;" onclick="openUrlFun(this)">(点击打开链接)<b style="font-weight: initial;">'+urlReplace+'</b></i>';
											textCon = textCon.replace(urlReplace,endUrl);
											linkMores[i].innerHTML = textCon;
										}
										linkMores[i].className = 'ft14 maincl overTwo';
									}
								}
								changUrl();


								$(window).scroll(function() {
									if(document.getElementsByClassName("dyCon")[typeNum].style.display == 'block'){//判断是否是 当前显示的盒子
											var scrollTop = $(this).scrollTop();
											if(typeNum == 0){
												SH0 = $(this).scrollTop();
											}else if(typeNum == 1){
												SH1 = $(this).scrollTop();
											}
											var scrollHeight = $(document).height();
											var windowHeight = $(this).height();
											if(scrollTop + windowHeight == scrollHeight) {
												if(Spagenum <= data.data.totalPages && Spagenum == Ypagenum + 1) { //当前页小于等于总页数时请求下一页
													mui("#upload")[0].innerHTML = "<img src='../img/balls.svg' />";
													Ypagenum++; //满足加载情况,应到页数+1
													console.log('发起请求,实到' + Spagenum + '页');
													console.log('发起请求,应到' + Ypagenum + '页');
													if(typeNum == 0){
														var dataJson = {
															'numsPerPage':6,
															'currentPage':Spagenum,
															'orderType':'DESC',
															'orderField':'create_time',
															'typeId':1
														}
													}else if(typeNum == 1){
														var myuserid = plus.storage.getItem('userid');
														var dataJson = {
															'userId':myuserid,
															'numsPerPage':6,
															'currentPage':Spagenum,
															'orderType':'DESC',
															'orderField':'create_time',
															'isFriends':1,
															'typeId':1
														}
													}else if(typeNum == 2){
														var dataJson = {
															'numsPerPage':6,
															'currentPage':1,
															'orderType':'DESC',
															'orderField':'create_time',
															'smoneDays':1,
															'typeId':1
														}
													}else if(typeNum == 3){
														var dataJson = {
															'numsPerPage':6,
															'currentPage':1,
															'orderType':'DESC',
															'orderField':'create_time',
															'smoneDays':7,
															'typeId':1
														}
													}

													mui.ajax(serverUrl + '/api/friends/newslist', {
														data: dataJson,
														dataType: 'json',
														type: 'post',
														timeout: 10000,
														headers: {"token": oldToken,'city': cityNum},
														success: function(data) {
															console.log('交友列表续'+typeNum, data);
															if(data.errno == 0) {
																var dataObj = {};
																if(typeNum == 2 || typeNum == 3){
																	var nowArray = data.data;
																}else{
																	var nowArray = data.data.data;
																}
																for(var j = 0 ;j<nowArray.length;j++){
																	//整理头像格式
																	if(nowArray[j].avatar && nowArray[j].avatar!='null'){
																		if(JSON.parse(nowArray[j].avatar)[0].picImg.indexOf('http') == -1){
																			nowArray[j].avatar = serverimgUrl + JSON.parse(nowArray[j].avatar)[0].picImg;
																		}else{
																			nowArray[j].avatar = JSON.parse(nowArray[j].avatar)[0].picImg
																		}
																	}else{
																		nowArray[j].avatar = '../img/10.png'
																	}

																	if(nowArray[j].nickname && nowArray[j].nickname !='null'){
																		if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(nowArray[j].nickname)){
																			nowArray[j].nickname = nowArray[j].nickname.substring(0,3)+"****"+nowArray[j].nickname.substring(7,11)
																		}
																	}else{
																		nowArray[j].nickname = '匿名'
																	}
																	if(!nowArray[j].read){
																		nowArray[j].read = 0
																	}else if((nowArray[j].read / 1000)>1){
																		nowArray[j].read = parseInt(nowArray[j].read / 1000) +'K+'
																	}
																	if(!nowArray[j].likes || nowArray[j].likes<0){
																		nowArray[j].likes = 0
																	}
																	var dt = new Date(nowArray[j].create_time).getTime();
																	nowArray[j].create_time = getDateDiff(dt);
																	/*整理内容图片格式*/
																	var nowArray2 = JSON.parse(nowArray[j].pic);
																	if(nowArray2.length){
																		var picS = [];
																		for(var k = 0 ;k<nowArray2.length;k++){
																			picS.push(nowArray2[k].picImg);
																		}
																		nowArray[j].picS = picS;
																	}
																}
																dataObj.dataList = nowArray;
																document.getElementsByClassName("dyCon")[typeNum].innerHTML += template("listDataS", dataObj);
																lazyLoad(false,10);//懒加载
																changUrl();//链接跳转方法

																//操作表
																var jbuid='',junsid,nowThis = null;
																$('.goanswer').click(function(){
																	junsid = $(this).attr('data-id');
																	jbuid = $(this).attr('data-useRId');
																	nowThis = $(this);
																	event.stopPropagation();
																	$('#maskInfo').fadeIn(200);

																})
																window.doJubao= function(){
																	if(plus.storage.getItem('myToken')){
																		jubao(junsid,jbuid,myuserid,cityNum,oldToken);
																		//console.log('nowThis' , nowThis);
																		nowThis.parent().parent().parent().parent().css('display','none');
																	}else{
																		mui.toast('请登录');
																		openview({
																			view:'login.html'
																		});
																	}
																}

																$('#maskInfo li').click(function(){
																	event.stopPropagation()
																})
																$('#maskInfo,.closeMask').click(function(){
																	event.preventDefault()
																	$('#maskInfo').fadeOut(200);
																})
															}
															mui("#upload")[0].innerHTML = " ";
															Spagenum++; //加载成功,当前页+1
															console.log('成功+1,实到' + Spagenum);
															console.log('成功+1,应到' + Spagenum);
														},
														error: function(xhr, type, errorThrown) {
															Ypagenum--; //失败是应到-1
															mui.toast("当前网络不好请重试");
															mui("#upload")[0].innerHTML = "";
														}
													});
												} else if(Spagenum == data.data.totalPages + 1) { //当前页不小于等于总页数时请求下一页
													//mui.toast('没有更多了');
												}
											}
									}
								});

								//操作表
								var jbuid='',junsid,nowThis = null;
								$('.goanswer').click(function(){
									junsid = $(this).attr('data-id');
									jbuid = $(this).attr('data-useRId');
									nowThis = $(this);
									event.stopPropagation();
									$('#maskInfo').fadeIn(200);

								})
								window.doJubao= function(){
									if(plus.storage.getItem('myToken')){
										jubao(junsid,jbuid,myuserid,cityNum,oldToken);
										//console.log('nowThis' , nowThis);
										nowThis.parent().parent().parent().parent().css('display','none');
									}else{
										mui.toast('请登录');
										openview({
											view:'login.html'
										});
									}
								}

								$('#maskInfo li').click(function(){
									event.stopPropagation()
								})
								$('#maskInfo,.closeMask').click(function(){
									event.preventDefault()
									$('#maskInfo').fadeOut(200);
								})

								//评论数据
								$('.commentsShow').each(function(){
									var newsId= $(this).attr('data-id');
									var curShow = $(this);
									mui.ajax(serverUrl + '/api/friends/newscomment/newsId/'+newsId, {
										dataType: 'json',
										type: 'get',
										timeout: 8000,
										headers: {"token": oldToken,'city': cityNum},
										success: function(data, type, xhr) {
											console.log('评论详情', data)

											if(data.errno == 0) {
												var cmtArray = data.data;
												var newCmt = []
												if(cmtArray && cmtArray.length>0){
													if(cmtArray.length >3){
														for(var i = 0;i<3;i++){
															if(cmtArray[i].nickname && cmtArray[i].nickname !='null'){
																if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].nickname)){
																	cmtArray[i].nickname = cmtArray[i].nickname.substring(0,3)+"****"+cmtArray[i].nickname.substring(7,11)
																}
															}else{
																cmtArray[i].nickname = '匿名'
															}

															if(!cmtArray[i].TO_nickname){
																cmtArray[i].TO_nickname =  '匿名'
															}else{
																if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].TO_nickname)){
																	cmtArray[i].TO_nickname = cmtArray[i].TO_nickname.substring(0,3)+"****"+cmtArray[i].TO_nickname.substring(7,11)
																}
															}
															var dt = new Date(cmtArray[i].create_time).getTime();
															cmtArray[i].create_time = getDateDiff(dt);
															newCmt.push(cmtArray[i])
														}
													}else{
														for(var i = 0;i<cmtArray.length;i++){
															if(cmtArray[i].nickname && cmtArray[i].nickname !='null'){
																if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].nickname)){
																	cmtArray[i].nickname = cmtArray[i].nickname.substring(0,3)+"****"+cmtArray[i].nickname.substring(7,11)
																}
															}else{
																cmtArray[i].nickname = '匿名'
															}

															if(!cmtArray[i].TO_nickname){
																cmtArray[i].TO_nickname =  '匿名'
															}else{
																if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].TO_nickname)){
																	cmtArray[i].TO_nickname = cmtArray[i].TO_nickname.substring(0,3)+"****"+cmtArray[i].TO_nickname.substring(7,11)
																}
															}
															var dt = new Date(cmtArray[i].create_time).getTime();
															cmtArray[i].create_time = getDateDiff(dt);
															newCmt.push(cmtArray[i])
														}
													}

													curShow.html(template('cmtTpl',{list:newCmt,allL:cmtArray.length}))
												}


											}else{
												//mui.toast('当前网络不好,请重试');
											}
										},
										error: function(xhr, type, errorThrown) {
											console.error('评论列表,响应失败');
											//mui.toast('当前网络不好,请重试');
										}
									});
								})

							}else{
								mui.toast('当前网络不好,请重试');
							}
						},
						error: function(xhr, type, errorThrown) {
							console.error('交友列表,响应失败');
							mui.toast('当前网络不好,请重试');
						}
					});

				})
			}

			//发布时间判断
			var minute = 1000 * 60;
			var hour = minute * 60;
			var day = hour * 24;
			var halfamonth = day * 15;
			var month = day * 30;
			function getDateDiff(dateTimeStamp){
				var now = new Date().getTime();
				var diffValue = now - dateTimeStamp;
				var monthC =diffValue/month;
				var weekC =diffValue/(7*day);
				var dayC =diffValue/day;
				var hourC =diffValue/hour;
				var minC =diffValue/minute;
				if(monthC>=1){
				 result=parseInt(monthC) + "月前";
				 }
				 else if(weekC>=1){
				 result=parseInt(weekC) + "周前";
				 }
				 else if(dayC>=1){
				 result=parseInt(dayC) +"天前";
				 }
				 else if(hourC>=1){
				 result=parseInt(hourC) +"小时前";
				 }
				 else if(minC>=1){
				 result=parseInt(minC) +"分钟前";
				 }else{
				 result="刚刚";
				 }
				return result;
			}
		</script>
		<script type="text/javascript">
			//顶部栏目跳转
			$('.goFeriend').click(function(){
				openview({
					view:'socialCircle/make_friends.html'
				})
			})
			$('.goCircle').click(function(){
				openview({
					view:'socialCircle/circleAll.html',
					id:'circleAll'
				})
			})
			$('.goAround').click(function(){
				openview({
					view:'socialCircle/around.html'
				})
			})
			$('.goHot').click(function(){
				openview({
					view:'socialCircle/ranking.html'
				})
			})
 			$(".mui-backdrop").unbind()

 			//更多热门
 			$('#todayHOt').click(function(){
 				openview({
 					view:'socialCircle/make_friends.html'
 				})
 			})
 			$('.paddDiv').click(function(){
 				openview({
 					view:'socialCircle/elsecircleIndex.html',
 					id:'elsecircleIndex'
 				})
 			})


 			//动态详情1
 			function DTdetail(id,userid){
 				openview({
 					view:'socialCircle/circleListInfo.html',
 					extrasobj:{
						infoid: id,
						UserId:userid,
					}
 				})
 			}
 			/*滑动显示发布按钮*/
//			var fangxiang;
//			function scroll(fn) {
//				var beforeScrollTop = document.body.scrollTop,
//					fn = fn || function() {};
//				window.addEventListener("scroll", function() {
//					var afterScrollTop = document.body.scrollTop,
//						delta = afterScrollTop - beforeScrollTop;
//					if(delta === 0) return false;
//					fn(delta > 0 ? "down" : "up");
//					beforeScrollTop = afterScrollTop;
//				}, false);
//			}
//			scroll(function(direction) {
//				fangxiang = direction;
//			});
//
//			$(window).scroll(function() {
//				if(fangxiang == 'up') {
//					document.getElementById('fabu').className = 'fabu1';
//				}else{
//					document.getElementById('fabu').className = 'fabu2';
//				}
//			})
			document.getElementsByClassName('QandA')[0].addEventListener('touchmove',function(){
				document.getElementById('fabu').className = 'fabu2';
			})
			document.getElementsByClassName('QandA')[0].addEventListener('touchend',function(){
				clearTimeout(timeFsbu1);
				var timeFsbu1 = setTimeout(function(){
					document.getElementById('fabu').className = 'fabu1';
				},800)
			})

			$('#fabu').click(function(){
				if(plus.storage.getItem('myToken')){
					openview({
						view:'socialCircle/circlePublish.html',
						id:'circlePublish'
					})
				}else{
					mui.toast('请登录');
					openview({
						view:'login.html'
					});
				}

			})
			$('.friendCenter').click(function(){
				if(plus.storage.getItem('myToken')){
					openview({
						view:'socialCircle/mycircleIndex.html',
						id:'mycircleIndex',
					})
				}else{
					mui.toast('请登录');
					openview({
						view:'login.html'
					});
				}

			})
			mui.previewImage();
		</script>
	</body>

</html>