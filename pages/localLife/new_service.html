<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>新增服务</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		
		<style type="text/css">
			.data ul li i{
				position: absolute;
				right: 10px;
			}
			.data ul li .shuru{
				margin-bottom: 0;
			}
			.chooseAd{
				text-align: left !important;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			.hasManyCitytwo .baocun{
				font-size: 0.12rem;
			}
			.toggle--off{
				background-color: #f53c42 !important;
			}
			
			.mui-btn {
				font-size: 16px;
				padding: 8px;
				margin: 3px;
			}
			#showCityPicker3{
				position: absolute;
				right: 10px;
				line-height: 49px;
				border: none;
				padding: 0;
				text-align: right;
				width: 75%;
				background-color: rgba(0,0,0,0);
			}
			.data ul li span{
				line-height: 49px;
			}
			.ui-alert{
				padding: 0;
				line-height: 50px;
				text-align: left;
				float: right;
				width: 76%;
				font-size: 16px;
			}
			.data ul li .shuru{
				line-height: 16px;
				text-align: left;
				width: 76%;
				height: 49px;
			}
			.data ul li{
				height: 50px;
			}
			.plist ul li{
				border-bottom: 1px solid #efeff4;
			}
			.address-btn{
				border-top: none;
				border-bottom: none;
				margin-top: 4%;
			}
			.add-address .textare{
				border-bottom: none;color: #666;
			}
			.mobile{
				margin: 50px 0 0 0;
			}
			
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,#theSearch{
				color: #fff;
			}
			.mui-bar-nav{
				box-shadow: none;
			}
			.dealcard, .cinemacard{
				margin-top: 45px;
			}
			.dealcard .dealcard-img img{
				height: 60px;
				overflow: hidden;
			}
			.mui-icon-camera:before {
				content: '\e301'
			}
			@font-face {
				font-family:Muiicons;font-weight:400;font-style:normal;src:url(fonts/mui.ttf) format('truetype')
			}
			.mui-icon {
				font-family: Muiicons;
				font-size: 24px;
				font-weight: 400;
				font-style: normal;
				line-height: 1;
				display: inline-block;
				text-decoration: none;
				-webkit-font-smoothing: antialiased
			}
			.mui-icon.mui-right:before {
				float: right;
				padding-left: .2em
			}
			*{
			    -webkit-box-sizing: border-box;
			            box-sizing: border-box;
			    outline: none;
			    -webkit-tap-highlight-color: transparent;
			    -webkit-tap-highlight-color: transparent;
			}
			.mui-btn{
			    font-size: 14px;
			    font-weight: 400;
			    line-height: 1.42;
			    position: relative;
			    display: inline-block;
			    margin-bottom: 0;
			    padding: 6px 12px;
			    cursor: pointer;
			    -webkit-transition: all;
			            transition: all;
			    -webkit-transition-timing-function: linear;
			            transition-timing-function: linear;
			    -webkit-transition-duration: .2s;
			            transition-duration: .2s;
			    text-align: center;
			    vertical-align: top;
			    white-space: nowrap;
			    background-clip: padding-box;
			}
			.mui-btn-outlined.mui-btn-primary, .mui-btn-outlined.mui-btn-blue{
			    color: #f53c42;
			    border: 1px solid #f53c42;
			}
			.mui-btn-block{
			    font-size: 18px;
			    display: block;
			    width: 100%;
			    margin-bottom: 10px;
			    padding: 15px 0;
			}
			.mui-table-view{
			    position: relative;
			    margin-top: 0;
			    margin-bottom: 0;
			    padding-left: 0;
			    list-style: none;
			}
			.mui-table-view-cell{
			    position: relative;
			    overflow: hidden;
			    padding: 11px 15px;
			    -webkit-touch-callout: none;
			}
			.mui-table-view-cell > a:not(.mui-btn){
			    position: relative;
			    display: block;
			    overflow: hidden;
			    margin: -11px -15px;
			    padding: inherit;
			    white-space: nowrap;
			    text-overflow: ellipsis;
			    color: inherit;
			}
			.mui-popover{
			    position: absolute;
			    z-index: 999;
			    display: none;
			    width: 280px;
			    -webkit-transition: opacity .3s;
			            transition: opacity .3s;
			    -webkit-transition-property: opacity;
			            transition-property: opacity;
			    -webkit-transform: none;
			            transform: none;
			    opacity: 0;
			    border-radius: 7px;
			    background-color: #f7f7f7;
			    -webkit-box-shadow: 0 0 15px rgba(0, 0, 0, .1);
			            box-shadow: 0 0 15px rgba(0, 0, 0, .1);
			}
			.mui-popover .mui-popover-arrow{
			    position: absolute;
			    z-index: 1000;
			    top: -25px;
			    left: 0;
			    overflow: hidden;
			    width: 26px;
			    height: 26px;
			}
			.mui-popover .mui-popover-arrow:after{
			    position: absolute;
			    top: 19px;
			    left: 0;
			
			    width: 26px;
			    height: 26px;
			
			    content: ' ';
			    -webkit-transform: rotate(45deg);
			            transform: rotate(45deg);
			
			    border-radius: 3px;
			    background: #f7f7f7;
			}
			.mui-popover .mui-popover-arrow.mui-bottom{
			    top: 100%;
			    left: -26px;
			
			    margin-top: -1px;
			}
			.mui-popover .mui-popover-arrow.mui-bottom:after{
			    top: -19px;
			    left: 0;
			}
			.mui-popover.mui-popover-action{
			    bottom: 0;
			    width: 100%;
			    -webkit-transition: -webkit-transform .3s, opacity .3s;
			            transition:         transform .3s, opacity .3s;
			    -webkit-transform: translate3d(0, 100%, 0);
			            transform: translate3d(0, 100%, 0);
			    border-radius: 0;
			    background: none;
			    -webkit-box-shadow: none;
			            box-shadow: none;
			}
			.mui-popover.mui-popover-action .mui-popover-arrow{
			    display: none;
			}
			.mui-popover.mui-popover-action.mui-popover-bottom{
			    position: fixed;
			}
			.mui-popover.mui-popover-action.mui-active{
			    -webkit-transform: translate3d(0, 0, 0);
			            transform: translate3d(0, 0, 0);
			}
			.mui-popover.mui-popover-action .mui-table-view .mui-table-view-cell:after{
			    position: absolute;
			    right: 0;
			    bottom: 0;
			    left: 0;
			    height: 1px;
			    content: '';
			    -webkit-transform: scaleY(.5);
			            transform: scaleY(.5);
			}
			.mui-popover.mui-popover-action .mui-table-view small{
			    font-weight: 400;
			    line-height: 1.3;
			    display: block;
			}
			.mui-popover.mui-active{
			    display: block;
			    opacity: 1;
			}
			.mui-popover .mui-bar ~ .mui-table-view{
			    padding-top: 44px;
			}
			.mui-backdrop{
			    position: fixed;
			    z-index: 998;
			}
			header{
				height: 50px !important;
			}
			header h1,.mui-bar-nav.mui-bar .mui-icon, .mui-title, #theSearch{
				line-height: 50px !important;
				padding: 0;
			}
			.sure {
				margin-top: 10px;
			}
			.sure button{
				width: 95%;
				background-color: #f53c42;
				color: #fff;
				border: none;
				height: 42px;
				font-size: 16px;
			}
			.mui-btn-primary{
				background-color: #fff !important;
				width: 95%;
			}
			#container{
				margin-bottom: 30px;
			}
			/*图片上传*/
	    	*{margin: 0;padding: 0;box-sizing: border-box;} 
	    	.clearfix:after {content: ""; display: block; clear:both;}
	    	.uppics{text-align: center;overflow-y: hidden;background-color: #fff;;}
	    	.uppics div.onepic{height: 120px;padding: 0 !important;padding-top: 31px !important;font-size: 14px;}
		    .uppics div.onepic img{width: 50px;} 
		    .uppics div.onepic input{width: 0px;height: 0px;position: relative;top:15px;left:28px;outline: none;}
		    #uppics2{text-align: left;white-space: nowrap;overflow-x: scroll;}
		    #uppics2 div{display: inline-block;width: 120px;height:120px;vertical-align: middle;position: relative;text-align: center;padding: 10px;
		    background-color: #eee;margin-right: 6px;}
		    #uppics2 .onepic{width: 120px;background-color: #eee;} 
		    #uppics2 .picimg{width: 100%;}
		    .picimg1{width: 25px;position: absolute;right: 0px;top: 2px;}
		    .timeinput{}
		    .timeinputdiv{width: 50%;float: left;}
		    .data ul li span{color: #555;}
		    
		    /*免责申明同意*/
		   	.disclaimer{
				line-height: 50px;
				padding-left: 5%;
				margin-top: 10px;
		   	}
		   	.disclaimer p{
		   		color: #f53c42;
		   		font-size: 14px;
		   		text-align: center;
		   		width: 100%;
		   	}
		   	.gray{
		   		color: #999 !important;
		   	}
		    .timeinput{} 
		    .timeinputdiv{width: 50%;float: left;} 
		    .data ul li span{color: #555;} 
		     
		    /*.data ul li p{display: none;}.data ul li .shuru{width: 100%;}.plist ul li{border: none;}
		    .afterI:after{content: '';display: block;height: 1px;background-color: rgba(0,0,0,0.1);-webkit-transform: scaleY(.5);}
		    .afterI2:before{content: '';display: block;height: 1px;background-color: rgba(0,0,0,0.1);-webkit-transform: scaleY(.5);position: relative;top: 50px;}
		    .ui-alert{width: 100% !important;height: 50px;}*/
		   .hasManyCitytwo .baocun{font-size: 15px;margin: 0;}
		    .hasManyCitytwo .header-tit{font-size: 15px;left: 49%;}
		    .mui-bar-nav.mui-bar .mui-icon{margin-left: -2px;}
		    .showCityPicker222{width: 37%;margin-top: 11px;padding: 6px 0;border: none;}
		    .shijianp{position: relative;}
		    .shijianp:after{     
		    	content: "~";
			    position: absolute; 
			    top: 14px;
			    font-size: 25px;
			    right: 36%;
			    color: #777;}  
		   #showCityPicker4{
				position: absolute;
				right: 10px;
				line-height: 49px;
				border: none;
				padding: 0;
				text-align: right;
				width: 75%;
				background-color: rgba(0,0,0,0);
				color: #000;
			}
    </style>
	</head>

	<body>
		<!--header star-->
	  
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">服务发布</h1>  
		    <a  id="Releasebtn" style="line-height: 50px;color:white;" class="fr baocun" onclick="help()">提交</a>
		</header>
		
		<script src="../../js/statusBar.js"></script><!--状态栏-->
		<!--上传图片-->
		<div class="uppics clearfix" style="margin-top: 50px;">
	        <div class="onepic" >
	            <input type="file" id="file_input"/> 
	            <img src="../../img/zhaoxiangji.svg">
	            <p>添加照片</p>
	        </div>
	    </div>
		<!--上传图片结束-->
		<div id="container" style="margin-top:-40px">
		    <div id="main" class="mui-clearfix add-address">
		    	<div id="thisAddLi"></div>
		    	<div class="plist clearfloat data">
					<ul>
						<li class="clearfloat">
							<a class="afterI">
								<p class="fl">服务名称</p>
								<input type="text" class="fr shuru Ynull" name="" id="Bname" value="" placeholder="请输入服务名称" />
							</a>
						</li>
						<li class="clearfloat">
							<a class="afterI">
								<p class="fl">电话</p>
								<input type="number" class="fr shuru Ynull" name="" id="Bphone" value="" placeholder="请输入电话" />
							</a>
						</li>
						<li class="clearfloat">
							<a class="afterI afterI2">
								<p class="fl">称谓</p>
								<input type="text" class="fr shuru Ynull" name="" id="Bcall" value="" placeholder="请输入称谓" />
							</a>
						</li>
						<textarea name="" rows="4" id="Binfo" placeholder="请填写描述" class="textare box-s Ynull"></textarea>
						<li class="clearfloat" style="border-top: 1px solid #efeff4;">
							<a class="afterI shijianp">
								<p class="fl">服务时段</p> 
								<!--<input type="text" class="fr shuru Ynull" name="" id="Btime" value="" placeholder="请输入服务时段" />-->
								<button id="showCityPicker2" class="showCityPicker222" style="margin-left: 6%;" type="button">开始时间</button>
								<button id="showCityPicker22" class="showCityPicker222" type="button">结束时间</button>
							</a>
						</li>
						<li class="clearfloat">
							<a id="mapAddress" class="afterI">
								<p class="fl">服务范围</p>
								<button id="showCityPicker3" type="button"><span class="mui-icon mui-icon-arrowdown"></span></button>
								<div id="cityResult3" class="ui-alert"><span id="province" class="Brange1">请选择区域</span><span id="city" class="Brange2"></span><span id="area" class="Brange3"></span></div>
							</a>
						</li>
						<li class="clearfloat" id="Bclass2">
							<a href="javascript:;" id="mapAddress">
								<p class="fl">身份</p>
								<button id='showCityPicker4' type='button'><span class="mui-icon mui-icon-arrowdown"></span></button>
								<div id='cityResult4' class="ui-alert">请选择身份</div>
							</a>
						</li>
						<li class="clearfloat">
							<a class="afterI">
								<p class="fl">价格</p>
								<input type="number" class="fr shuru Ynull" name="" id="Bprice" value="" placeholder="请输入价格" />
							</a>
						</li>
						<li class="clearfloat">
							<a class="afterI">
								<p class="fl">地址</p>
								<input type="text" class="fr shuru Ynull" name="" id="Baddress" value="" placeholder="请输入地址" />
							</a>
						</li>
					</ul>
				</div>
				<div class="disclaimer">
					<p class="fl" onclick="disclaimer()"><span class="gray">发布即同意</span>免责申明</p>
				</div>
		    </div>
		</div>
<script src="../../js/mui.min.js"></script>
<script src="../../js/app.js"></script>
<script src="../../js/mui.picker.min.js"></script>
<script src="../../js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/timedata.js" type="text/javascript" charset="utf-8"></script>
<script>
//点击免责申明
function disclaimer(){
	openview({
		view:'disclaimer.html'
	})
}
(function($, doc) {
	$.init();
	$.ready(function() {
		//时间二级联动
		var cityPicker = new $.PopPicker({
			layer: 2
		});
		document.getElementsByClassName('mui-pciker-rule')[1].innerHTML += '<span style="position: relative;left: 97%;">:</span>'; 
		cityPicker.setData(cityData);
		var showCityPickerButton2 = doc.getElementById('showCityPicker2');
		var showCityPickerButton22 = doc.getElementById('showCityPicker22');
		var cityResult = doc.getElementById('cityResult');
		showCityPickerButton2.addEventListener('tap', function(event) {
			cityPicker.show(function(items) {
				showCityPickerButton2.innerHTML = items[0].text + ":" + items[1].text;
				//返回 false 可以阻止选择框的关闭
				//return false; 
			});
		}, false); 
		showCityPickerButton22.addEventListener('tap', function(event) {
			cityPicker.show(function(items) {
				showCityPickerButton22.innerText =  items[0].text + ":" + items[1].text;
				//返回 false 可以阻止选择框的关闭
				//return false; 
			});
		}, false);
		
		
		//地址选择三级联动
		var cityPicker3 = new $.PopPicker({ 
			layer: 3
		});
		cityPicker3.setData(cityData3);
		var showCityPickerButton = doc.getElementById('showCityPicker3');
		var cityResult3 = doc.getElementById('cityResult3');
		showCityPickerButton.addEventListener('tap', function(event) {
			cityPicker3.show(function(items) {
				doc.getElementById('province').innerText = (items[0] || {}).text + " ";
				doc.getElementById('city').innerText =  (items[1] || {}).text + " ";
				doc.getElementById('area').innerText = (items[2] || {}).text + " ";
				//返回 false 可以阻止选择框的关闭
				//return false;
			});
		}, false);
	});
})(mui, document);
</script>

<script type="text/javascript">
	//选择图片
	var onepic = document.getElementsByClassName('onepic')[0];
    var uppics = document.getElementsByClassName('uppics')[0];
    var p = document.getElementById('p');
    var time1 = null;
    var Apic = [];//存放图片数组
    var Indexes = 0;//当前删除
    onepic.onclick = function(){  
    	var file_input = document.getElementById('file_input');
    	if(Apic.length<=4){
    		if(Apic.length ==4){
    			file_input.style.display = 'none';
    		}else{
    			file_input.style.display = 'inline-block';
    		}
			
        uppics.id = 'uppics2';
        var imgnode = document.createElement("div");
        clearInterval(time1);
        time1 = setInterval(function(){
            console.log('加载中');
            if (file_input.files[0]) {
                clearInterval(time1);
                var reader = new FileReader();
                Apic.push(file_input.files[0]);
                var picname = file_input.files[0].name;
                reader.readAsDataURL(file_input.files[0]); 
                reader.onload = function(e){
                    imgnode.innerHTML = '<img class="picimg1 '+picname+'" src="../../img/shanchu.svg"/><img class="picimg" src="'+this.result+'"/>';
                    document.getElementsByClassName('picimg1')[Indexes].onclick = function(){
                        this.parentNode.parentNode.removeChild(this.parentNode);
                        var dename = this.className.slice(8);
                        for (var i = 0; i < Apic.length; i++) {
                            if (Apic[i].name == dename) {
                               Apic.splice(i,1);
                            }
                        }
                        Indexes--;
                    }
                    Indexes++;
                }
                uppics.appendChild(imgnode);
                file_input.value = '';
            }
        },500)
       }else{
       	file_input.style.display = 'none';
       	mui.toast('最多选择五张');
       }
    }
	//选择图片结束
	
	
	var reg_phone = /^1((3|4|5|8|7){1}\d{1}|70)\d{8}$/;//手机号正则
	mui.plusReady(function(){
		//接受上页面参数
		var nowwebname = plus.webview.currentWebview().name;//当前webview对象name属性
		var Bnowid = plus.webview.currentWebview().Bname;
		var Btype = plus.webview.currentWebview().Btype;
		var Btypename = plus.webview.currentWebview().type_name;
		var type_name;
		switch(nowwebname){
			case 'Repair'://维修数据
			type_name = 1;
			break;
			case 'Clean'://保洁数据
			type_name = 2;
			break;
			case 'Babysister'://保姆数据
			type_name = 3;
			break;
			case 'Openclock'://开锁数据
			type_name = 4;
			break;
		}
		//获取上个页面参数结束
		
		//上传部分
		var oldtoken = plus.storage.getItem('oldToken');
		var myuserid = plus.storage.getItem('userid');
		var cityNum  = plus.storage.getItem('cityNum');
		mui('#Releasebtn')[0].onclick = function(){
			var classification_1;//身份
			switch(mui('#cityResult4')[0].innerHTML){
				case '商家':
				classification_1 = 1;
				break;
				case '个人':
				classification_1 = 0;
				break;
			}
			var Ynulls = mui('.Ynull');
			var timeduan = mui('#showCityPicker2')[0].innerHTML + " ~ " + mui('#showCityPicker22')[0].innerHTML;
			var Rangeinfo = mui('#province')[0].innerHTML + mui('#city')[0].innerHTML + mui('#area')[0].innerHTML;
			if(!reg_phone.test(mui('#Bphone')[0].value)){
				mui.toast('请输入正确的手机号');
				mui('#Bphone')[0].focus();
			}else if(Rangeinfo == '请选择区域'){
				mui.toast('请选择服务范围');
			}else if(timeduan.indexOf('时间')>-1){ 
				mui.toast('请选择服务时段'); 
			}else if(mui('#cityResult4')[0].innerHTML == "请选择身份"){
				mui.toast('请选择身份');
			}else{
				 if(Bnowid){//修改上传
			 		for (var i=0; i<Ynulls.length; i++) {
						if(!Ynulls[i].value){
							Ynulls[i].focus();
							mui.toast('请输入'+Ynulls[i].placeholder);
							break; 
						}
						if(i==Ynulls.length-1){
							plus.nativeUI.showWaiting('发布中 ...',{width:'100px',height:'80px'});//显示等待框
							//发送数据
							var formD = new FormData();
//							formD.append('logo',Apic[0]);
//							if(Apic.length>1){
//								console.log('图片张数'+Apic.length); 
//								for (var j=1; j<Apic.length; j++) {
//									console.log('添加banner');
//									formD.append('banner_pic',Apic[j]);
//								} 
//							}
							formD.append('my_local_service',Bnowid);
							formD.append('userid',myuserid);
							formD.append('name',mui('#Bname')[0].value);
							formD.append('type_name',Btypename);
//							formD.append('star',mui('#Bphone')[0].value);
							formD.append('content',mui('#Binfo')[0].value);
							formD.append('open_time',timeduan);
							formD.append('address',mui('#Baddress')[0].value);
							formD.append('service_cope',Rangeinfo);
							formD.append('link_man',mui('#Bcall')[0].value);
							formD.append('phone',mui('#Bphone')[0].value);
							formD.append('price',mui('#Bprice')[0].value);
							var xhr = new XMLHttpRequest(); 	
		        			xhr.open('POST',serverUrl+'/api/localservice/updatelocalservice');
		        			xhr.onreadystatechange = function(){ 
		        				if (xhr.readyState===4) {
		        					if (xhr.status===200) {
		        						plus.nativeUI.closeWaiting();//关闭等待框
		        						console.log(xhr.responseText);
		        						var dataobj = JSON.parse(xhr.responseText);
		        						console.log(dataobj);
		        						if(dataobj.errno == 0){
		        							mui.toast('修改成功');	
		        							//触发跳转页面刷新
											mui.fire(plus.webview.getWebviewById('personal/my-publish.html'),'refresh',{Btype:Btype});
											var time2 = setTimeout(function(){
												plus.webview.currentWebview().close();
											},500)
		        						}else{
		        							mui.toast('发布失败');	
		        						}
		        					}
		        				}
					        }
		        			xhr.setRequestHeader("token",oldtoken);
		        			xhr.setRequestHeader("city",cityNum);
		        			xhr.send(formD);
						} 
					}
				 }else{/*新增*/
					if(Apic.length<2){
						mui.toast('请至少选择两张图片');
					}else{
						for (var i=0; i<Ynulls.length; i++) {
							if(!Ynulls[i].value){
								Ynulls[i].focus();
								mui.toast('请输入'+Ynulls[i].placeholder);
								break; 
							}
							if(i==Ynulls.length-1){
								plus.nativeUI.showWaiting('发布中 ...',{width:'100px',height:'80px'});//显示等待框
								//发送数据
								var formD = new FormData();
								formD.append('logo',Apic[0]);
								if(Apic.length>1){
									console.log('图片张数'+Apic.length); 
									for (var j=1; j<Apic.length; j++) {
										console.log('添加banner');
										formD.append('banner_pic',Apic[j]);
									} 
								}
								formD.append('userid',myuserid);
								formD.append('name',mui('#Bname')[0].value);
								formD.append('type_name',type_name);
	//							formD.append('star',mui('#Bphone')[0].value);
								formD.append('content',mui('#Binfo')[0].value);
								formD.append('open_time',timeduan);
								formD.append('address',mui('#Baddress')[0].value);
								formD.append('service_cope',Rangeinfo);
								formD.append('link_man',mui('#Bcall')[0].value);
								formD.append('phone',mui('#Bphone')[0].value);
								formD.append('price',mui('#Bprice')[0].value);
								formD.append('isbusiness',classification_1);//商家个人
								
								console.log(myuserid);
								console.log(mui('#Bname')[0].value);
								console.log(mui('#Binfo')[0].value);
								console.log(mui('#Baddress')[0].value);
								console.log(mui('#Bcall')[0].value);
								console.log(mui('#Bphone')[0].value);
								console.log(mui('#Bprice')[0].value);
								console.log(timeduan);
								console.log(Rangeinfo);
								console.log(type_name);
								
								var xhr = new XMLHttpRequest(); 	
			        			xhr.open('POST',serverUrl+'/api/localservice/addlocalservice');
			        			xhr.onreadystatechange = function(){ 
			        				if (xhr.readyState===4) {
			        					if (xhr.status===200) {
			        						plus.nativeUI.closeWaiting();//关闭等待框
			        						var dataobj = JSON.parse(xhr.responseText);
			        						console.log(xhr.responseText);
			        						if(dataobj.errno == 0){
			        							mui.toast('发布成功');	
			        							//触发跳转页面刷新
			        							plus.nativeUI.showWaiting('跳转中 ...',{width:'100px',height:'80px'});//显示等待框
												mui.fire(plus.webview.getWebviewById('theList.html'),'refresh');
												var time2 = setTimeout(function(){
													plus.webview.currentWebview().close();
													plus.nativeUI.closeWaiting();
												},500) 
			        						}else{
			        							mui.toast(dataobj.errmsg);	
			        						}
			        					}
			        				}
						        }
			        			xhr.setRequestHeader("token",oldtoken);
			        			xhr.setRequestHeader("city",cityNum);
			        			xhr.send(formD);
							} 
						}
					}
				}
			}
			
		}
	})
	//编辑显示既有部分
	mui.plusReady(function(){
		if(plus.webview.currentWebview().Bname){
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			var Bnowid = plus.webview.currentWebview().Bname;
			//显示信息
			var oldtoken = plus.storage.getItem('oldToken');
			var cityNum  = plus.storage.getItem('cityNum');
			mui.ajax(serverUrl+'/api/localservice/localserviceinfo',{
				data:{sericeId:Bnowid},
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken,'city':cityNum},	               				
				success:function(data){
					console.log('获取既有数据返回'+JSON.stringify(data)); 
					if(data.errno == 0){
						mui('#Bname')[0].value = data.data[0].name;
						mui('#Binfo')[0].value = data.data[0].content;
						//时间段
						console.log();
						if(data.data[0].open_time.indexOf('-')>-1){
							mui('#showCityPicker2')[0].innerHTML = data.data[0].open_time.split('-')[0];
							mui('#showCityPicker22')[0].innerHTML = data.data[0].open_time.split('-')[1];	
						}else{
							mui('#showCityPicker2')[0].innerHTML = data.data[0].open_time.split('~')[0];
							mui('#showCityPicker22')[0].innerHTML = data.data[0].open_time.split('~')[1];
						}
						
						mui('#Baddress')[0].value = data.data[0].address;
						mui('#province')[0].innerHTML = data.data[0].service_cope;
						mui('#Bcall')[0].value = data.data[0].link_man;
						mui('#Bphone')[0].value = data.data[0].phone;
						mui('#Bprice')[0].value = data.data[0].price;
						mui('#cityResult4')[0].innerHTML = '有身份';
						mui('#Bclass2')[0].style.display = 'none';
					}else{  
						mui.toast('获取用户信息失败');
						console.log(data.errmsg);
					}
					plus.nativeUI.closeWaiting();//关闭等待框
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();//关闭等待框
					mui.toast('响应失败  !');
				}
			});
		}
		
		
	})
</script>
<script>
	(function($, doc) {
		$.init();
		$.ready(function() {
			//分类选择
			var userPicker = new $.PopPicker();
			userPicker.setData([{
				text: '商家'
			}, {
				text: '个人'
			}]);
			var showUserPickerButton = doc.getElementById('showCityPicker4');
			var userResult = doc.getElementById('cityResult4');
			showUserPickerButton.addEventListener('tap', function(event) {
				userPicker.show(function(items) {
					userResult.innerText = items[0].text;
					//返回 false 可以阻止选择框的关闭
					//return false;
				});
			}, false);
		});
	})(mui, document);
</script>

	</body>

</html>