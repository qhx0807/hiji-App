<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>维修(保洁..)详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">

		<style type="text/css">

			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			.mui-bar{height: 50px;
			}
			.mui-title,.mui-icon{line-height: 50px;
			}
			.mui-bar .mui-icon{padding: 0;
			}
			.mui-bar-nav.mui-bar .mui-icon,.mui-title,.mui-icon{color: #fff;
			}
			.mui-bar-nav{box-shadow: none;
			}
			.mui-icon{line-height: 50px;
			}
			.mui-icon .iconfont{font-size: 18px;
			}
			.dealcard, .cinemacard{margin-top: 50px;
			}
			.dealcard .dealcard-img img{height: 60px;
				overflow: hidden;
			}
		 	.shoucang .iconfont{font-size: 18px;
			}
			.dealcard, .cinemacard{margin-top: 45px;
			}
			.dealcard, .cinemacard{margin-top: 45px;
			}

			.farm .bottom ul li{text-overflow: ellipsis;white-space: nowrap;
				overflow: hidden;
				display: block;
				width: 100%;
			}
			/*banner图片固定高度比例*/
			.mui-slider-item a{
				position: relative;
				display: inline-block;
				padding-top: 55.56%;
				width: 100%;
				overflow: hidden;
			}
			.goodsImg{
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
			}
			.list,.bottom{
				border-bottom: 1px solid #EFEFF4 !important;
				border-top: 1px solid #EFEFF4 !important;
			}
			.top,.farm{
				border-bottom: none !important;
			}
			.farmtc .bt{
				border-top: 1px solid #EFEFF4 !important;
			}
			.merchant .biz-call .phone{margin-top: -7px;}
			.rentingtopbot {padding-bottom: 40px !important;}
			.farm .top p span{
				border-right: 0!important;
			}
			/*图片预览*/
			.mui-preview-image.mui-fullscreen {
				position: fixed;
				z-index: 99999;
				background-color: #000;
			}

			.comtPic {
				border-radius: 100%;
			}

			.mui-preview-header,
			.mui-preview-footer {
				position: absolute;
				width: 100%;
				left: 0;
				z-index: 10;
			}

			.goodsImg {
				width: 100%!important;
			}

			.mui-preview-header {
				height: 44px;
				top: 0;
			}

			.mui-preview-footer {
				height: 50px;
				bottom: 0px;
			}

			#textInfo img {
				width: 100%;
			}

			.mui-preview-header .mui-preview-indicator {
				display: block;
				line-height: 25px;
				color: #fff;
				text-align: center;
				margin: 15px auto 4;
				width: 70px;
				background-color: rgba(0, 0, 0, 0.4);
				border-radius: 12px;
				font-size: 16px;
			}

			.mui-preview-image {
				display: none;
				-webkit-animation-duration: 0.5s;
				animation-duration: 0.5s;
				-webkit-animation-fill-mode: both;
				animation-fill-mode: both;
			}

			.mui-preview-image.mui-preview-in {
				-webkit-animation-name: fadeIn;
				animation-name: fadeIn;
			}

			.mui-preview-image.mui-preview-out {
				background: none;
				-webkit-animation-name: fadeOut;
				animation-name: fadeOut;
			}

			.mui-preview-image.mui-preview-out .mui-preview-header,
			.mui-preview-image.mui-preview-out .mui-preview-footer {
				display: none;
			}

			.mui-zoom-scroller {
				position: absolute;
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
				-webkit-box-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				left: 0;
				right: 0;
				bottom: 0;
				top: 0;
				width: 100%;
				height: 100%;
				margin: 0;
				-webkit-backface-visibility: hidden;
				z-index: 999999;
			}

			.mui-zoom {
				-webkit-transform-style: preserve-3d;
				transform-style: preserve-3d;
			}

			.mui-slider .mui-slider-group .mui-slider-item img {
				width: auto;
				height: auto;
				max-width: 100%;
				max-height: 100%;
			}

			.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
				width: 100%;
			}

			.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
				display: inline-table;
			}

			.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
				display: table-cell;
				vertical-align: middle;
			}

			.mui-preview-loading {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
			}

			.mui-preview-loading.mui-active {
				display: block;
			}

			.mui-preview-loading .mui-spinner-white {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -25px;
				margin-top: -25px;
				height: 50px;
				width: 50px;
			}

			.mui-preview-image img.mui-transitioning {
				-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
				transition: transform 0.5s ease, opacity 0.5s ease;
			}

			@-webkit-keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}

			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}

			@-webkit-keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}

			@keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" id="header">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
		    <h1 class="mui-title">详情</h1>
			<!--<a href="setup.html" class="fr shoucang sousuo mui-icon"><i class="iconfont icon-fenxiang"></i></a>-->
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->

		<!--详情内容-->
		<div id="container">
			<div id="main"></div>
			<script type="text/html" id="details">
				<div class="deal">
					<!--轮播图-->
					<div class="mui-slider">
						<%if(pic.length){%>
							<div class="mui-slider-group mui-slider-loop">
						    <!--支持循环，需要重复图片节点-->
						    <div class="mui-slider-item mui-slider-item-duplicate">
						    	<a><img src="<%= pic[pic.length-1].picImg%>" class="goodsImg" data-preview-src="" data-preview-group="1"></a>
						    </div>
						    <% for(var i=0; i<pic.length; i++) {%>
						    	<div class="mui-slider-item">
						    		<a><img src=" <%= pic[i].picImg%>" class="goodsImg" data-preview-src="" data-preview-group="1"></a>
						    	</div>
						    <% }%>
						    <!--支持循环，需要重复图片节点-->
						    <div class="mui-slider-item mui-slider-item-duplicate">
						    	<a><img src="<%= pic[0].picImg%>" class="goodsImg" data-preview-src="" data-preview-group="1"></a>
						    </div>
						  </div>
			            <div class="mui-slider-indicator">
							<div class="mui-indicator mui-active"></div>
							<% for(var i=0;i<pic.length-1;i++){ %>
						    	<div class="mui-indicator"></div>
						    <% } %>
			            </div>
						<%}else{%>
						  <div class="mui-slider-group mui-slider-loop">
				    	  	<div class="mui-slider-item"><a><img src="../../img/market/none.png" class="goodsImg" data-preview-src="" data-preview-group="1"></a></div>
					      </div>
						<%}%>

					</div>
					<!--轮播图结束-->
					<div class="farm clearfloat">
						<div class="top rentingtop clearfloat box-s">
							<p style="font-size: 0.14rem;"><%= list[0].name%></p>
							<p class="time">
								发布时间：<span class="cspan" style="font-size: 0.12rem;"><%= list[0].create_time%></span>
								<small class="fr">评分：
								<%if(list[0].star){%>
									<%if(list[0].star>5){%>
										<%for(var j = 0;j<5;j++){%>
											 <img src="../../img/market/star.png" style="width: 0.1rem;" alt="" />
										<%}%>
									<%}else{%>
										<%for(var j = 0;j<list[0].star;j++){%>
											 <img src="../../img/market/star.png" style="width: 0.1rem;" alt="" />
										<%}%>
									<%}%>
								<%}%>

										<%for(var j = 0;j<grayStar;j++){%>
											<img src="../../img/market/graystar.png" style="width: 0.1rem;" alt="" />
										<%}%>
								</small>
								<!--浏览：413人-->
							</p>
						</div>
						<div class="bottom clearfloat box-s">
							<ul>
								<li>
									<p class="fl">服务范围：</p>
									<span class="cspan"><%= list[0].service_cope%></span>
								</li>
							</ul>
						</div>
					</div>
					<dl class="list">
						<dd class="dd-padding">
							<div class="merchant">
								<div class="biz-detail">
									<a class="react" href="#" title="">
										<h5 class="title single-line">电话: <span class="rspan"><%= list[0].phone%></span></h5>
										<div class="address single-line">联系人: <span class="rspan"><%= list[0].link_man%></span></div>
										<div class="address single-line">地址: <span class="rspan"><%= list[0].address%></span></div>
									</a>
								</div>
								<div class="biz-call">
									<a class="react phone" style="background: url(../../img/wlphone.png) no-repeat; background-size: 40px;background-position: center;" href="tel:<%=list[0].phone%>">
									</a>
								</div>
							</div>
						</dd>
					</dl>
				</div>
				<div class="farmtc clearfloat mt10">
					<p class="bt box-s">服务简介</p>
				</div>
				<div class="farm clearfloat">
					<div class="top rentingtop rentingtopbot clearfloat box-s">
						<p><%= list[0].content%></p>
					</div>
				</div>
			</script>
		</div>
	</body>
	<script src="../../js/app.js"></script>
	<script src="../../js/artTemplate-native.js"></script>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/mui.previewimage.js"></script>
	<script type="text/javascript">
		var div = document.getElementsByClassName('goodsImg');
		for (var i = 1;i<div.length;i++) {
			var width = div[i].offsetWidth;
	        div.style.height = width/2.4+"px";
		}
		mui.plusReady(function(){
			mui.previewImage();
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
			//获取数据
			var oldtoken = plus.storage.getItem('oldToken');
			var cityNum  = plus.storage.getItem('cityNum');
			var nowid = plus.webview.currentWebview().name;
			mui.ajax(serverUrl+'/api/localservice/localserviceinfo',{
				data:{"sericeId":nowid},
				type:'post',
				timeout:10000,
				headers:{"token":oldtoken,'city':cityNum},
				success:function(data){
					console.log('获取数据返回'+JSON.stringify(data));
					console.log('获取数据返回',data);
					if(data.errno == 0){
						var objdata = {};
						if(data.data[0].star){
							var grayStar = 5-parseFloat(data.data[0].star)
						}else{
							var grayStar =5
						}
						var dt = new Date(data.data[0].create_time);
						var date = [
						  [dt.getFullYear(), dt.getMonth() + 1, dt.getDate()].join('-')].join(' ').replace(/(?=\b\d\b)/g, '0'); // 正则补零
						data.data[0].create_time = date
						objdata.list = data.data;
						objdata.grayStar = grayStar;
						objdata.picurl = serverimgUrl;
						objdata.pic = JSON.parse(objdata.list[0].pic);//轮播图
						var html=template("details",objdata);
						document.getElementById("main").innerHTML=html;
						plus.nativeUI.closeWaiting();
						//轮播图
						var gallery = mui('.mui-slider');
						gallery.slider({
						  interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
						});
					}else{
						mui.toast('获取用户信息失败');
						plus.nativeUI.closeWaiting();
						console.log(data.errmsg);
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui.toast('当前网络不好请重试');
				}
			});
		})
	</script>
</html>