<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>宏帆广场</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<link rel="stylesheet" href="../../css/one.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../js/artTemplate-native.js"></script>
		<script src="../../js/mui.min.js"></script>
		<style type="text/css">
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			
			#banner{
				position: relative;
				width: 100%;
				padding-top: 42%; 
				overflow: hidden;
				background: url(../../img/bannerback.svg) 50% 50% no-repeat;
				background-size: 20%;
			}
			.mui-slider .mui-slider-group{
				position: absolute;
			    height: 100%;
			    width: 100%;
			    top: 0;
			}
			.mui-slider .mui-slider-group .mui-slider-item img{height: 100%;}
			.onetable{
				margin-top: 0;
			}
			.onetable p{
				margin-top: -10px;
				font-size: 11px;
				color: #666;
				margin-bottom: 5px;
			}
			.onetable img{
				padding: 5px;
			}
			 
			.mui-bar{
				height: 50px;
			}
			.mui-title,.mui-icon{
				line-height: 50px;
			}
			.mui-bar .mui-icon{
				padding: 0;
			}
			
			
			/*这一页*/
			.onetable{
				/*padding-top: 5px;*/
				border-bottom: 0 solid #e6e6e6;
				padding-bottom: 10px;
				background-color: #fff;
			}
			.onetable table img {
				width: 60%;
			    margin: 0.10rem 0;
			    margin-top: 5px;
			}
			.onetable p {
				margin-top: -16px;
				font-size: 12px;
		    	padding-right: 3px;
			}
			.market-icon{
				border-radius: 50%;
				width: 0.6rem;
				height: 0.6rem;
				display: block;
				margin: 10px auto;
			}
			 
			.left{
				border-left: 0.03rem solid #f53c42;
				padding-left: 10px;
			}
			td{
				text-align: center;
			}
			 
		 	#main{
		 		margin-top: 50px;
		 		}
		 	h4{
		 		color: #666 !important;
		 	}
		 	.activityIcon{
			width: 0.3rem;
			margin: 0 5px 0 15px;
			vertical-align: middle;
		}
		dl.list{
			border: none;
		}
		.acleft img{ 
			width: 1rem;
			max-height: 1rem;
			
		}
		.acright{ 
			width:-moz-calc(100% - 1rem);
			width:-webkit-calc(100% - 1rem);
			width: calc(100% - 1rem);
			font-size: 0.14rem;
			line-height: 1.5;
    		padding-left: 5%;
		}
		 
		.ddafter{ 
			padding:12px 12px;
			position: relative;
		}
		.ddafter:not(:last-child):after{
			content: '';
			position: absolute;
			width: 100%;
			display: block;
			bottom: 0;
			height: 1px;
			left: 0;
			background-color: rgba(0,0,0,0.1);
			-webkit-transform: scaleY(0.5);
		}
		.aclist{
			padding: 0 auto 0.05rem auto;
			display: flex;
			align-items: center;
		}
		.Ctitle{
			font-size: 18px;
			line-height: 35px;
		}
	 	.acright img{
	 		width: 14px;
	 		margin-right: 5px;
	 	}
	 	small{
	 		color: #999 !important;
	 	}
	 	.red1{
	 		color: #F53C42;
	 		white-space: nowrap;
	 		width: 90%;
	 		overflow: hidden;
	 		text-overflow: ellipsis;
	 		font-size: 16px;
	 		line-height: 35px;
	 		font-weight: bold;
	 	}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			<h1 class="mui-title">宏帆广场</h1>
		</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->  
		<div id="main">
			<div id="scroller">
				<!--轮播图-->
				<div class="mui-slider" id="banner"></div>
				<!--轮播图结束-->
				<!--banner数据渲染-->
				<script type="text/html" id="banner-detail">
					<div class="mui-slider-group mui-slider-loop">
					    <!--支持循环，需要重复图片节点-->
					    <div class="mui-slider-item mui-slider-item-duplicate">
					    	<% if(bannerList[bannerList.length-1].url==null || bannerList[bannerList.length-1].url=='') { %>
					    		<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>" />
					    	<% }else{ %>
					    		<a onclick="bannerGo('<%=bannerList[bannerList.length-1].url%>','<%=bannerList[bannerList.length-1].name%>','two')"> 
						    		<img src="<%= url %><%= bannerList[bannerList.length-1].bannerPic %>"  />
						   		</a>
					    	<% } %>
					    </div>
						<% for(var i=0;i<bannerList.length;i++){ %> 
						    <div class="mui-slider-item">
								<% if(bannerList[i].url==null || bannerList[i].url=='') { %>
						    		<img src="<%= url %><%= bannerList[i].bannerPic %>"/>
						    	<% }else{ %>
						    		<a onclick="bannerGo('<%=bannerList[i].url%>','<%=bannerList[i].name%>','two')">
							    		<img src="<%= url %><%= bannerList[i].bannerPic %>" />
							   		</a>
						    	<% } %>
					    	</div>
					    <% } %>
					    <!--支持循环，需要重复图片节点--> 
					    <div class="mui-slider-item mui-slider-item-duplicate">
							<% if(bannerList[0].url==null || bannerList[0].url=='') { %>
					    		<img src="<%= url %><%= bannerList[0].bannerPic %>" />
					    	<% }else{ %>
					    		<a onclick="bannerGo('<%=bannerList[0].url%>','<%=bannerList[0].name%>','two')">
						    		<img src="<%= url %><%= bannerList[0].bannerPic %>" />
						   		</a>
					    	<% } %>
					    </div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<% for(var i=0;i<bannerList.length-1;i++){ %>
					    	<div class="mui-indicator"></div>
					    <% } %>
		            </div> 
				</script>
				<div class="onetable" style="margin-bottom: 0.05rem;">
					<table> 
						<tbody>
							<tr>
								<td class="youhui"> 
										<img src="../../img/market/youhuiicon.png"/> 
									<br/>
									<p>优惠</p>
								</td> 
								<td  class="mtactivity">
										<img src="../../img/market/huodongicon.png"/> 
									<br/>
									<p>活动</p>
								</td>
								<td class=" findstore"> 
										<img src="../../img/market/zhaodianicon.png"/> 
									<br/>
									<p>找店</p>
								</td>
								
								<td class="sales"> 
										<img src="../../img/market/zhaoshangicon.png"/>
									<br/>
									<p>招商</p>
								</td>
								
							</tr>
							 
						</tbody>
					</table>
					
				</div>
				<!--精选频道-->
				<div class="sy_recmd">
					<div class="sy_title" style="display: none;">
						<span class="left">精选频道</span>
					</div> 
					<div style="background-color: white;" id="Alist"></div>
					<!--渲染数据-->
					<script type="text/html" id="Alist-detail">
						<% for(var i = 0;i<objData.length;i++){ %>
							<div class="mui-table-view-cell ddafter" onclick="activity(<%= objData[i].id %>)">
								<div class="mui-row aclist">
									 <div class="acleft">
									 	<%if(objData[i].picImg){%>
									 		<img name="<%= objData[i].picImg%>" onerror="this.src='../../img/market/none.png'" src="<%= objData[i].picImg%>" alt="" />
									 	<%}else{%>
									 		<img src="../../img/market/none.png" alt="" />
									 	<%}%>	
									 	
									 </div>
									 <div class="acright"> 
									 	<div class=""><%= objData[i].title %></div>
									 	<div><small><img src="../../img/market/time.png" style="width: 12px;"/><%= objData[i].begin_time%> ~ <%= objData[i].end_time%></small></div>
									 	<!--<div><small>店铺名称： <%= objData[i].site %></small></div>-->
									 </div>
								</div>
							</div>
						<% } %>
					</script>
					<div id="nulldiv" style="text-align:center;margin-top: 40%;font-size: 14px;color: #999;display: none;">
						<img style="width: 30%;margin-bottom: 5%; " src="../../img/unllfabu.svg"/>
						<br />
						没有相关活动
					</div>
				</div> 
			</div> 
		</div>
		<!--遮罩1-->
		<div id="maskInfo1" class="maskInfo" style="display: none;z-index:9999;">
			<img src="../../img/chahao.png" class="closeMs"/>
			<div class="ruleCt" style="padding-bottom: 50px;padding: 0;">
				<img src="../../img/mainHtml/mask5.png" style="border-radius: 3px;width: 100%;height: 100%;" onclick='goCoupon()'/>
				<!--<div style="overflow-y: scroll;height: 100%;margin-bottom: 50px;">
					<div class="ft16 fttc" style="text-align: center;">首页弹窗1</div>
					<ol class="ft14 disablecl ruleol">
					</ol>
				</div>
				<button type="button" class="mui-btn mui-btn-danger mar10 closemask" >查看</button>-->
				
			</div>
		</div>
		<!--遮罩2-->
		
		<div id="maskInfo2" class="maskInfo" style="display: none;z-index:9998;">
			<img src="../../img/chahao.png" class="closeMs"/>
			<div class="ruleCt" style="padding-bottom: 50px;">
				<div style="overflow-y: scroll;height: 100%;margin-bottom: 50px;">
					<div class="ft16 fttc" style="text-align: center;">首页弹窗2</div>
					<ol class="ft14 disablecl ruleol">
					</ol>
				</div>
				<button type="button" class="mui-btn mui-btn-danger mar10 closemask" >查看</button>
				
			</div>
		</div>
		<!--遮罩3-->
		
		<div id="maskInfo3" class="maskInfo" style="display: none;z-index:9997;">
			<img src="../../img/chahao.png" class="closeMs"/>
			<div class="ruleCt" style="padding-bottom: 50px;">
				<div style="overflow-y: scroll;height: 100%;margin-bottom: 50px;">
					<div class="ft16 fttc" style="text-align: center;">首页弹窗3</div>
					<ol class="ft14 disablecl ruleol">
					</ol>
				</div>
				<button type="button" class="mui-btn mui-btn-danger mar10 closemask" >查看</button>
				
			</div>
		</div>
	<script src="../../js/app.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		
		 (function(){
			//跳转页面  
			var mtactivity = document.getElementsByClassName('mtactivity')[0];
			var sales = document.getElementsByClassName('sales')[0];  
			var findstore = document.getElementsByClassName('findstore')[0];
		  
			findstore.addEventListener('tap', function(){
				openview({
					view:'storeListFloor.html'
				});
			});
			 
			mtactivity.addEventListener('tap', function(){
				openview({
					view: "../activity/activity.html",
					extrasobj: {
						type: 2,
						acid: 2
					}
				})
			});
			sales.addEventListener('tap', function(){
				openview({
//					view:"../activity/coupon.html"
//					view:"../carPool/carpool.html"
					view:"merchants.html"
				})
			});
			mui('.youhui')[0].addEventListener('tap',function(){
				openview({
					view:"BuyOffer.html"
//					view:'../activity/coupon.html'
				})
			}) 
			$('.ruleCt').click(function(){
				event.stopPropagation()
			})
			$('#maskInfo1').click(function(){
				event.preventDefault()
				$('#maskInfo1').fadeOut(200);
			})
			$('#maskInfo2').click(function(){
				event.preventDefault()
				$('#maskInfo2').fadeOut(200);
			}) 
			$('#maskInfo3').click(function(){
				event.preventDefault()
				$('#maskInfo3').fadeOut(200);
			}) 
			$('.closeMs').click(function(){
				event.stopPropagation();
				$(this).parent().fadeOut(200);
			})
			
		})();
		function goCoupon(){/*优惠券*/
			event.stopPropagation();
			$('#maskInfo1').fadeOut(200);
			openview({
				view:'BuyOffer.html',
				id:"BuyOffer",
			});
		}
		mui.plusReady(function(){ 
			//获取缓存
			var oldToken = plus.storage.getItem('oldToken');
			var cityNum = plus.storage.getItem('cityNum');
			//plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});//显示等待框
			//banner数据渲染
			/*弹框*/
			mui.ajax(serverUrl + '/api/index/showmodal', {
	            type: 'post',
	            timeout: 10000,
	            headers: { "token": oldToken,'city':cityNum},
	            success: function(data, type, xhr) { 
	               	plus.nativeUI.closeWaiting();
	            		console.log('弹窗',data)
	            		if(data.errno == 0){
	            			if(data.data.localSquare && data.data.dailySpecials.length){
	            				mui.each(data.data.localSquare,function(index,item){
	                    			 if(item == 1){
	                    			 	$('#maskInfo'+(index+1)).show()
	                    			 }else{
	                    			 	$('#maskInfo'+(index+1)).hide()
	                    			 }
	                    		})
	            			}
	            		}
	            },
	            error: function(xhr, type, errorThrown) {
	            		console.log('首页弹窗',type)
	                console.log('响应失败');
	               	plus.nativeUI.closeWaiting();
	            }
	        });
			mui.ajax(serverUrl+'/api/index/banner',{
				data:{banner_type:2,},
				dataType:'json',
				type:'post',
				timeout:10000,
				headers:{"token":oldToken,'city': cityNum},	 
				success:function(data,type,xhr){
					console.log('banner',data);
					if(data.errno==0){
						bannerObj={};
//						bannerObj.bannerList = eval("("+data.data.banner+")");
						bannerObj.bannerList = JSON.parse(data.data.banner);
						console.log(bannerObj.bannerList);
						
//						bannerObj.url = serverimgUrl;
						var html = template('banner-detail',bannerObj);
						document.getElementById('banner').innerHTML = html;
						//轮播图,获得slider插件对象
						var gallery = mui('.mui-slider');
						gallery.slider({
						  	interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
						});
					}
				},
				error:function(xhr,type,errorThrown){
					console.log('宏帆广场,banner响应失败');
					plus.nativeUI.closeWaiting();//关闭等待框
					
				}
			});  
			mui.ajax(serverUrl+'/api/index/couponoractivity',{
				data:{"type":1},
				type:'post',
				timeout:10000,
				headers:{"token":oldToken,'city':cityNum},	 
				success:function(data){
					console.log('活动列表返回',data);
					if(data.errno == 0){
						if(data.data.length){
							var dateObj={};
							for(var i = 0;i < data.data.length;i++){
								var dt = new Date(data.data[i].begin_time);
					       		var dt2 = new Date(data.data[i].end_time);
								var date = [
								  [dt.getFullYear(), dt.getMonth() + 1, dt.getDate()].join('-')].join(' ').replace(/(?=\b\d\b)/g, '0'); // 正则补零
								var date2 = [
								  [dt2.getFullYear(), dt2.getMonth() + 1, dt2.getDate()].join('-')].join(' ').replace(/(?=\b\d\b)/g, '0'); // 正则补零
								
								data.data[i].begin_time = date;
								data.data[i].end_time = date2;
							}
							dateObj.objData=data.data;
							dateObj.url = serverimgUrl;
							mui('#Alist')[0].innerHTML = template('Alist-detail',dateObj);
						}else{
							mui('#nulldiv')[0].style.display = 'block';
						}
					}else{
						mui.toast('响应失败  !');
						mui('#nulldiv')[0].style.display = 'block';
					}
					plus.nativeUI.closeWaiting();
				},
				error:function(xhr){
					mui('#nulldiv')[0].style.display = 'block';
					plus.nativeUI.closeWaiting();
					mui.toast('响应失败  !');
				}
			}); 
		
 })
		//打开详情
		function activity(id){
			openview({
				view:'../activity/activityDetail.html',
				id:'activityDetail', 
				extrasobj:{activityId:id}
			})
		}
	</script>
	<script type="text/javascript">
		//天天特价  discountGoods, 领嗨豆  getHIdou, 团购  groupBuying, 本地生活 localLife, 跨境优品   loveToGogoods, 电影 movie,
		//充值缴费   payment,  为民服务  serveForPeople,  购物中心 shopCenter, 注册  signUp, 特色馆 specialBar
		mui.plusReady(function () {
			var startTime, endTime, stayTime, flagback = 0;
			startTime = new Date().getTime();
			var old_back = mui.back;
			//改写返回键返回的函数，返回时传页面停留时间 
			mui.back = function(){
				endTime = new Date().getTime();//返回时间
				stayTime = Math.ceil((endTime - startTime) / 1000);   
				console.log('购物中心'+stayTime); 
				plus.statistic.eventDuration( "shopCenter", stayTime);
				//计算事件，计算出返回时在该页面停留的时间差值，除以六万获得停留分钟数，发送给友盟后台
				old_back(); 
			}
			plus.webview.currentWebview().addEventListener( "popGesture", function(){
				flagback++;
				if(flagback == 1){
					endTime = new Date().getTime();
					stayTime = Math.ceil((endTime - startTime) / 1000);  
					plus.statistic.eventDuration( "shopCenter", stayTime);
					//计算事件，计算出苹果右滑返回后在该页面停留的时间差值，除以六万获得停留分钟数，发送给友盟后台
				}
			}, false );
		});
	</script> 
	</body>
	
</html>