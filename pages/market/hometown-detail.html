<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>商品详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/other.js"></script>
		<style type="text/css">
			.mui-preview-image.mui-fullscreen {
				position: fixed;
				z-index:99999;
				background-color: #000;
			}
			.comtPic{
				border-radius: 100%;
			}
			.mui-preview-header,
			.mui-preview-footer {
				position: absolute;
				width: 100%;
				left: 0;
				z-index: 10;
			}
			.goodsImg{
				width: 100%!important;
			}
			.mui-preview-header {
				height: 44px;
				top: 0;
			}
			.mui-preview-footer {
				height: 50px;
				bottom: 0px;
			}
			#textInfo img{
				width: 100%;
			}
			.mui-preview-header .mui-preview-indicator {
				display: block;
				line-height: 25px;
				color: #fff;
				text-align: center;
				margin: 15px auto 4;
				width: 70px;
				background-color: rgba(0, 0, 0, 0.4);
				border-radius: 12px;
				font-size: 16px;
			}
			.mui-preview-image {
				display: none;
				-webkit-animation-duration: 0.5s;
				animation-duration: 0.5s;
				-webkit-animation-fill-mode: both;
				animation-fill-mode: both;
			}
			.mui-preview-image.mui-preview-in {
				-webkit-animation-name: fadeIn;
				animation-name: fadeIn;
			}
			.mui-preview-image.mui-preview-out {
				background: none;
				-webkit-animation-name: fadeOut;
				animation-name: fadeOut;
			}
			.mui-preview-image.mui-preview-out .mui-preview-header,
			.mui-preview-image.mui-preview-out .mui-preview-footer {
				display: none;
			}
			.mui-zoom-scroller {
				position: absolute;
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
				-webkit-box-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				left: 0;
				right: 0;
				bottom: 0;
				top: 0;
				width: 100%;
				height: 100%;
				margin: 0;
				-webkit-backface-visibility: hidden;
				z-index: 999999;
			}
			.mui-zoom {
				-webkit-transform-style: preserve-3d;
				transform-style: preserve-3d;
			}
			.mui-slider .mui-slider-group .mui-slider-item img {
				width: auto;
				height: auto;
				max-width: 100%;
				max-height: 100%;
			}
			.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
				width: 100%;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
				display: inline-table;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
				display: table-cell;
				vertical-align: middle;
			}
			.mui-preview-loading {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
			}
			.mui-preview-loading.mui-active {
				display: block;
			}
			.mui-preview-loading .mui-spinner-white {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -25px;
				margin-top: -25px;
				height: 50px;
				width: 50px;
			}
			.mui-preview-image img.mui-transitioning {
				-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
				transition: transform 0.5s ease, opacity 0.5s ease;
			}
			@-webkit-keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@-webkit-keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			@keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			/*banner底部导航*/
			.mui-slider-indicator .mui-indicator{
				width: 10px;
				height: 10px;
				border-radius: 8px;
				background: black;
				margin-right: 5px;
				opacity: 0.3;
				cursor: pointer;
				border: none;
				box-shadow: none;
			}
			.mui-slider-indicator .mui-active.mui-indicator{
				background-color: rgba(245,60,66,0.8);
				box-shadow: none;
				opacity: 1;
				border: none;
			}
			/*这一页*/
			#main{
				padding-bottom: 60px;
			}
			.detail .top .xia .jifen{
				color: #f53c42;
				font-size: 24px;
				line-height: 40px;
			}
			sub{
				bottom: 0;
				font-size: 65%;
			}
			.detail .top .shang .you p{
				margin-top: 0.08rem;
			}
			.mui-row{
				margin: 0 10px;
			}
			.mui-row p{
				font-size: 12px;
				line-height: 15px;
			}
			.Mcenter{
				text-align: center;
			}
			.Mright{
				text-align: right;
			}
			.goBack{
				position: fixed;
				left: 15px;
				top: 40px;
				background-color: rgba(0,0,0,0.5);
				width: 40px;
				height: 40px;
				z-index: 9;
				border-radius: 50%;
			}
			.mui-icon{
				line-height: 40px;
				color: #FFF;
				display: inline-block;
				width: 40px;
				text-align: center;
				font-size: 26px;
			}
			/*评论*/
			.user-head img{
				width: 80%;
				margin: 10px 10%;
			}
			.Cright{
				padding: 10px;
			}
			.Cright p{
				line-height: 20px;
				color: #666 !important;
				display: block !important;
				float: left;
				font-size: 14px;
			}
			time{
				line-height: 20px;
				color: #999;
			}
			.comment{
				margin: 10px 2px;
			}
			.inlineBlock{
				padding: 2px;
			}
			.Cul{
				margin-top: -10px;
			}
			.Cli{
				border-bottom: 1px solid #eee;
				margin: 10px;
			}
			.Cli:last-child{
				border-bottom: none;
			}
			.zuo{
				color: #000 !important;
			}
			/*修改*/
			.addBtn{
				background-color: #ff9100 !important;
				border: 1px solid #ff9100 !important;
			}
			.mui-numbox{
				width: 100px;
				height: 30px;
				padding: 0 30px;
			}
			.mui-numbox .mui-btn{
				width: 30px;
			}
			.am-share-sns{
				height: 100% !important;
			}
			.sdetail .top .you{
				padding-bottom: 15px;
			}
			.Mscroll{
				max-height: 400px;
				overflow-y: scroll;
				z-index: -1;
				padding: 5px 0;
			}
			.sdetail{
				/*height: 490px;*/
			}
			.footerone .left{
				width: 15%;
			}
			.footerone .right{
				width: 85%;
			}
			.footerone .left ul li{
				width: 100%;
			}

			.comment{
				display: block;
			}
			.overflow_clear{
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				width: 100%;
				display: block;
			}
			.farm .top, .farm .bottom{
				border-bottom: 1px solid #EFEFF4;
			}
			.farmtc .bt{
				border-top: 1px solid #EFEFF4;
			}
			/*banner图片固定高度比例*/
			.mui-slider-item a{
				position: relative;
				display: inline-block;
				padding-top: 100%;
				width: 100%;
				overflow: hidden;
			}
			.goodsImg{
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
			}
			.sdetail .middle{
				position: relative;
				border-bottom: 0;
			}
			.sdetail .middle:after{
				visibility: visible;content: '';display: block;height: 1px;-webkit-transform: scaleY(0.5);background-color: rgba(0,0,0,0.1);position: absolute;width: 100%;bottom: 0;left: 0;
			}
		</style>
	</head>
	<body>
		<div class="goBack">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize fl fanhui"></a>
		</div>
		<div id="container">
			<div id="main" style="margin-top: 0!important;">
				<div class="warp warptwo clearfloat">
					<div class="detail clearfloat">
						<div id="moll_info"></div>

						<script type="text/html" id="infoTpl">
							<!--轮播图-->
							<div class="mui-slider">
								  <div class="mui-slider-group mui-slider-loop">
								    <!--支持循环，需要重复图片节点-->
								    <%if(infoData && infoData.length!=0){%>
								    	 <div class="mui-slider-item mui-slider-item-duplicate">
								    	<%if(infoData[infoData.length-1].bannerPic){%>
								    		<a><img src="<%=myUrl%><%=infoData[infoData.length-1].bannerPic%>" class="goodsImg"></a>
								    		<%}else{%>
								    			<a><img src="../../img/market/none.png" class="goodsImg"></a>
								    			<%} %>

										    </div>
										    <% for(var i=0;i<infoData.length;i++){ %>
										    <div class="mui-slider-item">
										    	<a>
										    		<img src="<%=myUrl%><%=infoData[i].bannerPic%>" class="goodsImg">
										    	</a>
										    </div>
										    	<% } %>
										    <!--支持循环，需要重复图片节点-->
										    <div class="mui-slider-item mui-slider-item-duplicate">
										    	<a>
										    		<img src="<%=myUrl%><%=infoData[0].bannerPic%>" class="goodsImg">
										    	</a>
										    </div>
								    	<%}else{%>
								    		 <div class="mui-slider-item mui-slider-item-duplicate">
										    	<a>
										    		<img src="../../img/market/none.png" class="goodsImg">
										    	</a>
										    </div>
								    		<div class="mui-slider-item">
										    	<a>
										    		<img src="../../img/market/none.png" class="goodsImg">
										    	</a>
										    </div>
								    		 <div class="mui-slider-item mui-slider-item-duplicate">
										    	<a>
										    		<img src="../../img/market/none.png" class="goodsImg">
										    	</a>
										    </div>
								    		<%}%>

								  </div>
							</div>
							<!--轮播图结束-->
						</script>

						<div id="gdBrief"></div>

						<script type="text/html" id="briefTpl">
							<div class="top clearfloat box-s">
								<div class="shang clearfloat">
									<div class="zuo clearfloat fl">
										<%=brief.title%>
									</div>
									<div class="you clearfloat fr">
										<ul>
											<li>
											 	<a onclick="goShop()">
													<i class="iconfont icon-shangcheng"></i>
													<p>商家</p>
												</a>
											</li>
										</ul>
									</div>
								</div> 
								<div class="xia clearfloat">
									<%if(brief.price){%>
										<%if(brief.originalprice){%>
											<p class="jifen fl box-s"><sub>￥</sub><samp style="font-family: '微软雅黑' !important;"><%=brief.price%></samp> <small style="font-size: 0.12rem;color: gray;">原价 <del>￥<%=brief.originalprice%></del></small></p>
										<%}else{%>
											<p class="jifen fl box-s"><sub>￥</sub><samp style="font-family: '微软雅黑' !important;"><%=brief.price%></samp></p>
										<%}%>
										<%}else{%>
											<p class="jifen fl box-s"><sub>￥</sub><samp>0</samp></p>
											<%}%>

								</div>
								<div class="xia">
									 <div class="mui-row">
								        <div class="mui-col-sm-4 mui-col-xs-4 Mleft">
								        	<%if(!brief.postage){%>
								           		<p class="box-s">快递：免邮</p>
								            <%}else{%>
								             <p class="box-s">快递：<%=brief.postage%>元</p>
								            <%}%>
								        </div>
								        <div class="mui-col-sm-4 mui-col-xs-4 Mcenter">
								        	<%if(brief.sales){%>
								        		 <p class="box-s">销量：<%=brief.sales%>笔</p>
								        		<%}else{%>
								            <p class="box-s">销量：0笔</p>
								            <%}%>

								        </div>
								        <div class="mui-col-sm-4 mui-col-xs-4 Mright">
								            <p class="box-s">重庆</p>
								        </div>
								  	</div>
								</div>
								<div class="farmtc" id="disPay" style="display: none;">
									<p class="bt" style="color: #f39826;padding-left: 10px;">该商品只做展示，暂不支持线上购买</p>
								</div>

							</div>
							
							
						
						<div class="farmtc" id="disPay" style="display: none;">
							<p class="bt" style="color: #f39826;padding-left: 10px;">该商品只做展示，暂不支持线上购买</p>
						</div>


					</div>
					<div class="farmtc clearfloat mt10">
						<p class="bt box-s">商品详情</p>
					</div>
					<div class="farm clearfloat">
						<div class="top rentingtop clearfloat box-s">
							<div id="textInfo"></div>

						</div>
					</div>

				</script>





				<div id="moll_comment"></div>
				<script type="text/html" id="commentTpl">
					<div class="farmtc clearfloat mt10">
						<p class="bt box-s">商品评价</p>
					</div>
					<ul class="farm clearfloat Cul">
						<%if(cemmentData.length==0){%>
							<div style="font-size:0.12rem;color:gray;padding:5%;text-align: center;">暂无评论</div>
								<%}else{%>
									<%for(var i=0;i<cemmentData.length;i++){%>
									<li class="mui-row Cli">
										<div class="mui-col-sm-2 mui-col-xs-2 user-head">
											<%if(cemmentData[i].avatar==null || cemmentData[i].avatar==''){%>
									    		<img src="../../img/10.png" class="radius comtPic" alt="" />
									    	<%}else{%>
												<img src="<%=myUrl%><%=cemmentData[i].avatar%>" class="radius comtPic" alt="" />
											<%}%>
										</div>
										<div class="comtContent Cright mui-col-sm-10 mui-col-xs-10">
					                        <div class="am-comment-author left">
					                        	<p><b class="black"><%=cemmentData[i].nickname%></b></p>
					                        </div>
					                        <time class="text-sm right gray">
					                            <%=cemmentData[i].seller_ctime%>
					                        </time>
					                        <div class="clear"></div>
					                        <div class="commentStar">
						                   		<%for(var j = 0;j<cemmentData[i].grade_star;j++){%>
						                   			<img src="../../img/market/star.png" style="width: 0.1rem;" alt="" />
						                   			<%}%><small style="color: red;"><%=cemmentData[i].grade_star%>分</small>
						                   	</div>
						                   	<div class="comment"><%=cemmentData[i].seller_comment%></div>
						                   	<div class="clear"></div>

					                        <div class="clear"></div>
						                    <div class="padding-h-xs mui-row">
											<%if(cemmentData[i].comment_pic.length!=0){%>
						                    	<%for(var j=0;j<cemmentData[i].comment_pic.length;j++){%>
						                    	<div class="inlineBlock mui-col-sm-3 mui-col-xs-3" style="display:inline-block;height: 0.5rem;overflow:hidden;">
						                    	<img src="<%=myUrl%><%=cemmentData[i].comment_pic[j].picImg%>" style="width: 100%;overflow: hidden;height: 0.5rem" data-preview-src="" data-preview-group="<%=i+1%>" />
						                    	</div>
						                    	<%}%>
						                    <%}%>
					                    </div>
									</div>
								</li>
							<%}%>
						<%}%>
					</ul>
				</script>
			</div>
		</div>
		<!--footerone star-->
		<div class="footerone clearfloat">

			<div class="left clearfloat fl">
				<ul>
					<li>
					 	<a onclick="gocart()">
							<img src="../../img/market/cartIcon.svg" alt="" />
						</a>
					</li>
				</ul>
			</div>
			<div class="right clearfloat fl">
				<span class="btn fl addBtn" onClick="toshare(1)">加入购物车</span>
                <a onClick="toshare(2)" class="btn btnone fl">立即购买</a>
			</div>
		</div>
		<!--footerone end-->
		<!--这里是弹出购物车内容-->
		<div class="am-share">
			<div id="cartBox"></div>
			<script type="text/html" id="boxTpl">
				<div class="am-share-footer">
			<span class="share_btn">
				<img src="../../img/chahao.png"/>
			</span>
		</div>
		  <div class="am-share-sns box-s">
		     <div class="sdetail clearfloat">
		     	<div class="top clearfloat">
		     		<div class="tu clearfloat fl">
		     			<span></span>
		     			<%if(choose.thumb){%>
		     			<img src="<%=myUrl%><%=choose.thumb%>" data-preview-src="" />
		     			<%}else{%>
		     			<img src="../../img/market/none.png" data-preview-src="" />
		     			<%}%>
		     		</div>
		     		<div class="you clearfloat fl">
		     			<p class="tit overflow_clear "><%=choose.title%></p>
		     			<span>￥<b id="priceChange"><%=choose.price%></b></span>
		     		</div>
		     	</div>
		     	<div class="Mscroll">
		     		<%if(choose.parameter){%>
		     			<%for(var i=0;i<choose.parameter.length;i++){%>
		     				<%if(choose.parameter[i].parameter_name){%>
		     				<div class="middle clearfloat textType">
					     		<p><%=choose.parameter[i].parameter_name%></p>
					     		<div class="xia clearfloat choose">
					     			<ul>
					     				<%if(choose.parameter[i].child_value.length!=0){%>
					     					<%for(var j=0;j<choose.parameter[i].child_value.length;j++){%>
					     						<%if(choose.parameter[i].child_value[j].equivalence){%>
					     						<li class="ra3" data-priceStep="<%=choose.parameter[i].child_value[j].equivalence%>"  data-Inventory="<%=choose.parameter[i].child_value[j].Inventory%>"><%=choose.parameter[i].child_value[j].child_parameter_name%></li>
				     						    <%}else{%>
				     						    <li class="ra3" data-priceStep="0"  data-Inventory="<%=choose.parameter[i].child_value[j].Inventory%>"><%=choose.parameter[i].child_value[j].child_parameter_name%></li>

				     						   <% }%>
				     						<%}%>
				     					<%}%>
						     		</ul>
					     		</div>
					     	</div>
					     	<%}%>
	     				<%}%>
	     			<%}%>
		     	<div class="bottom clearfloat">
		     		<p class="fl">购买数量</p>
		     		<div class="you clearfloat fr">
	     				<div class="mui-numbox margin-top" data-numbox-min="1">
	     					<button class="mui-btn mui-btn-numbox-minus" type="button" disabled="">-</button>
	     					<input id="test" class="mui-input-numbox" type="number" value="0">
	     					<button class="mui-btn mui-btn-numbox-plus add" type="button">+</button>
	     				</div>
		     		</div>
		     	</div>
		     	</div>
		     </div>
		</div>
		<a data-gdId="<%=choose.goods_id%>" data-shopId="<%=choose.storeid%>" data-shop="<%=choose.store_name%>" data-gdName="<%=choose.title%>" data-gdImg="<%=choose.thumb%>" data-gdprice="<%=choose.price%>" data-gdPostfee="<%=choose.postage%>" onclick="cartStorageF(this)" class="shop-btn db">确定</a>
			</script>

		</div>
	</body>
	<script src="../../js/app.js"></script>
	<script src="../../js/artTemplate-native.js"></script>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/mui.previewimage.js"></script>
	<script type="text/javascript">
		mui.plusReady(function(){
			var shopId;
			//获取token
			var token=plus.storage.getItem("oldToken");
			console.log(token)
			//获取页面传值 商品id
			var goodId = plus.webview.currentWebview().goodsId;
//			var goodId = 1;
			plus.nativeUI.showWaiting('加载中 ...',{width:'100px',height:'80px'});
			//请求商品详情
			mui.ajax(serverUrl+'/api/mall/goodsinfo', {
					data: {goodsId:goodId},
					dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						headers:{"token":token},
						success:function(data){
							console.log(JSON.stringify(data))
							if(data.errno==0){
								plus.nativeUI.closeWaiting();
								if(!data.data.goodsInfo.good_pic){
									data.data.goodsInfo.good_pic = null;
								}
									var dataobj =eval("("+data.data.goodsInfo.good_pic+")");

									var commentobj = data.data.comments;
									//var content = data.data.comments
									//banner
									var infoObj = {}
										infoObj.myUrl = serverimgUrl;
										infoObj.infoData = dataobj;
				                        document.getElementById("moll_info").innerHTML=template("infoTpl",infoObj);
				                      var gallery = mui(".mui-slider");
												gallery.slider({
													interval: 3000 //设置自动轮播周期为3s
												});





			                    //简介
			                     document.getElementById("gdBrief").innerHTML=template("briefTpl",{brief:data.data.goodsInfo});
			                     //只做展示的商品
								if(data.data.goodsInfo.differentiate=='5'){
									mui('.footerone')[0].remove();
									mui('#moll_comment')[0].remove();
									mui('#disPay')[0].style.display='block';
								}
			                     //详情
			                     if(data.data.goodsInfo.content){
			                     	document.getElementById("textInfo").innerHTML=data.data.goodsInfo.content;
			                     }else{
			                     	document.getElementById("textInfo").innerHTML='<div style="font-size:0.12rem;color:gray;padding:5%;text-align: center;">暂无详情</div>'
			                     }

			                      data.data.goodsInfo.parameter=eval("("+data.data.goodsInfo.parameter+")");
			                      shopId=data.data.goodsInfo.storeid;
			                     //选择弹框
			                     var chooseO = {};
			                     chooseO.choose = data.data.goodsInfo;
			                     chooseO.myUrl = serverimgUrl;
			                     document.getElementById("cartBox").innerHTML=template("boxTpl",chooseO);
			                     mui(".mui-numbox").numbox();
			                     var priceChange =parseInt($("#priceChange").html());
			                     $('.choose').each(function(){
			                     	var chooseli = $(this).find("li");

			                     		var oldstep=0,newstep=0;
			                     	chooseli.each(function(){
			                     		if($(this).attr("data-Inventory")==0){
					                     		$(this).css("display","block")
					                     	}
			                     		chooseli.eq(0).addClass("cur");
					                     	if($(this).attr("data-priceStep")==0){

					                     		oldstep = $(this).attr("data-priceStep");
					                     	}

			                     	})
			                     	chooseli.click(function(){
			                     		oldstep=newstep;
												$(this).addClass('cur');
												$(this).siblings().removeClass('cur');
					                     	  newstep = $(this).attr("data-priceStep");
					                     	 priceChange=priceChange+parseInt(newstep)-parseInt(oldstep);
					                     	 $('#priceChange').html(priceChange)
											})

			                     })


			                    //评论
			                    var cemmentObj = {}
			                    for(var i = 0;i < commentobj.length;i++){
											commentobj[i].seller_ctime = commentobj[i].seller_ctime.substring(0,10)+' '+commentobj[i].seller_ctime.substring(11,16);
											commentobj[i].comment_pic = eval("("+commentobj[i].comment_pic+")");
											commentobj[i].avatar = JSON.parse(commentobj[i].avatar)[0].picImg;
										}
									cemmentObj.myUrl = serverimgUrl;
									cemmentObj.cemmentData = commentobj;

			                    document.getElementById("moll_comment").innerHTML=template("commentTpl",cemmentObj);


			                   // plus.storage.removeItem('$cartStorage');
			                    //购物车 缓存
			                    var cartStorage =JSON.parse(plus.storage.getItem('$cartStorage')||'[]');

			                    window.cartStorageF=function(obj){
			                     	if($('.cur').length == $(".choose").length){
			                    		var shopName = obj.getAttribute("data-shop");
			                    		var goodsId = obj.getAttribute("data-gdId");
			                    		var storeid = obj.getAttribute("data-shopId");
			                    		var goodsName = obj.getAttribute("data-gdName");
			                    		var goodsImg = obj.getAttribute("data-gdImg");
			                    		var goodsPrice = priceChange;
			                    		var goodsPostfee = obj.getAttribute("data-gdPostfee");
			                    		if(!goodsPostfee){
			                    			goodsPostfee = 0;
			                    		}
			                    		var goodsnum = parseFloat($(".mui-input-numbox").val());
			                    		var goodText='';
			                    		var goodProp=[];
			                    		$('.textType').each(function(){
			                    			goodText+=$(this).find("p").html()+":"+$(this).find(".cur").html()+";";
			                    			var prop = {};
			                    			prop.parameter_name=$(this).find("p").html();
			                    			prop.child_parameter_name=$(this).find(".cur").html();
			                    			goodProp.push(prop)
			                    		})
			                    		//当前商品对象
										var cartObj={};
			                    		cartObj.goodsId=goodsId;
			                    		cartObj.shopName=shopName;
			                    		cartObj.shopId=storeid;
			                    		cartObj.goodsName=goodsName;
			                    		cartObj.goodsImg=goodsImg;
			                    		cartObj.goodsPrice=goodsPrice;
			                    		cartObj.goodsPostfee=goodsPostfee;
			                    		cartObj.goodsnum=goodsnum;
			                    		cartObj.goodText=goodText;
			                    		cartObj.goodProp=goodProp;

			                    		if(goNum ==1){
			                    			if(cartStorage.length != 0) {
										var flag = false;
										for(var i = 0; i < cartStorage.length; i++) {
											if(cartStorage[i].goodsId == goodsId && cartStorage[i].goodText == goodText) {

													cartStorage[i].goodsnum=parseInt(cartStorage[i].goodsnum)+parseInt(goodsnum);
												flag = false;
												break;
											} else {
												flag = true;
											}
										}
										if(flag) {
			                    		cartStorage.push(cartObj);
										}
									} else {
			                    		cartStorage.push(cartObj);
									}
			                    		plus.storage.setItem("$cartStorage",JSON.stringify(cartStorage));
			                    		$(".am-share").removeClass("am-modal-active");
			                    		$(".sharebg ").removeClass("sharebg-active");
			                    		mui.toast("已成功加入购物车");
			                    		//webview 购物车页面 刷新
			                    		  //获得列表界面的webview
										var list= plus.webview.getWebviewById('cart.html');
										//触发列表界面的自定义事件（refresh）,从而进行数据刷新
										mui.fire(list,'refresh');

			                    		}else{

			                    			if(plus.storage.getItem('myToken')){
												orderStorage =[];
				                    			orderStorage.push(cartObj);
				                    			plus.storage.setItem("$orderStorage",JSON.stringify(orderStorage));

				                    			openview({
												 	view:"market-order.html",
												 	id:"market-order"
												 })
											}else{//没登陆直接打开登录页面
												mui.toast('请登录');
												openview({
													view:'../login.html'
												});
											}



			                    		}




			                    	}else{
			                    		mui.toast("请选择商品属性");
			                    	}
			                    }
					//评论
					 //mui.previewImage();
								}else{
									plus.nativeUI.closeWaiting();
									mui.toast("网络不好请重试！")
								}


							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								plus.nativeUI.closeWaiting();
								mui.toast("当前网络不好请重试");
							}
					});
					//跳转商家详情
					window.goShop = function(){
						console.log(shopId);
						openview({
							view:"shophome.html",
							extrasobj:{storeId:shopId}
						})
					}
					window.gocart = function(){
						openview({
								view:"../cart.html",
								extrasobj:{pageId:"detail"}
							})
					}
					mui.previewImage();
		})

	</script>

</html>
