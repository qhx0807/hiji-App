<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>优惠券详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/common.css">
		<link rel="stylesheet" type="text/css" href="../../css/index.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/reset.css">
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/hmt.js" type="text/javascript"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<script src="../../js/app.js" type="text/javascript"></script>
		<!--引入模板引擎-->
		<script src="../../js/artTemplate-native.js" type="text/javascript"></script>
		
		<style type="text/css">
			.member .list .top .zuo{
				width: 100%;
				border-radius: 0;
				height: auto;
				-webkit-border-radius: 0;
			}
			.member .list .top .zuo img{
				max-height: none;
				max-width: 100%;
			}
			.member .list{
				height: inherit;
			}
			.member .list .top p.tit {
				font-size: 17px;
				margin-left: 5%;
			}
			.second{
				padding-top: 10px !important;
			}
			.member .list .bottom{
				border-top: 1px solid #efeff4;
			}
			
			
			.title{
				text-align: center;
				line-height: 35px;
				position: relative;
			}
			.limit{
				text-align: left;
				padding:0 5%;
				line-height: 20px;
				margin: 12px 0;
			}
			.limit p{
				font-size: 13px !important;
			}
			.bage{
			    display: inline-block;
			    border: 1px solid #EC971F;
			    line-height: 10px;
			    font-size: 10px !important;
			    padding: 3px 5px;
			    border-radius: 11px;
			    color: #EC971F;
			    position: absolute;
				top: 0;
				right: 10px;
			}
			.gray{
				border: 1px solid #868580;
				color: #868580;
			}
			h3.h3div{
			    line-height: 30px;
			    font-size: 17px !important;
			    padding-top: 0px;
			}
			
			/*图片预览*/
			/*图片预览*/
			.mui-preview-image.mui-fullscreen {
				position: fixed;
				z-index: 20;
				background-color: #000;
			}
			.mui-preview-header,
			.mui-preview-footer {
				position: absolute;
				width: 100%;
				left: 0;
				z-index: 10;
			}
			.mui-preview-header {
				height: 44px;
				top: 0;
			}
			.mui-preview-footer {
				height: 50px;
				bottom: 0px;
			}
			.mui-preview-header .mui-preview-indicator {
				display: block;
				line-height: 25px;
				color: #fff;
				text-align: center;
				margin: 15px auto 4;
				width: 70px;
				background-color: rgba(0, 0, 0, 0.4);
				border-radius: 12px;
				font-size: 16px;
			}
			.mui-preview-image {
				display: none;
				-webkit-animation-duration: 0.5s;
				animation-duration: 0.5s;
				-webkit-animation-fill-mode: both;
				animation-fill-mode: both;
			}
			.mui-preview-image.mui-preview-in {
				-webkit-animation-name: fadeIn;
				animation-name: fadeIn;
			}
			.mui-preview-image.mui-preview-out {
				background: none;
				-webkit-animation-name: fadeOut;
				animation-name: fadeOut;
			}
			.mui-preview-image.mui-preview-out .mui-preview-header,
			.mui-preview-image.mui-preview-out .mui-preview-footer {
				display: none;
			}
			.mui-zoom-scroller {
				position: absolute;
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-box-align: center;
				-webkit-align-items: center;
				align-items: center;
				-webkit-box-pack: center;
				-webkit-justify-content: center;
				justify-content: center;
				left: 0;
				right: 0;
				bottom: 0;
				top: 0;
				width: 100%;
				height: 100%;
				margin: 0;
				-webkit-backface-visibility: hidden;
			}
			.mui-zoom {
				-webkit-transform-style: preserve-3d;
				transform-style: preserve-3d;
			}
			.mui-slider .mui-slider-group .mui-slider-item img {
				width: auto;
				height: auto;
				max-width: 100%;
				max-height: 100%;
			}
			.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
				width: 100%;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
				display: inline-table;
			}
			.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
				display: table-cell;
				vertical-align: middle;
			}
			.mui-preview-loading {
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
			}
			.mui-preview-loading.mui-active {
				display: block;
			}
			.mui-preview-loading .mui-spinner-white {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -25px;
				margin-top: -25px;
				height: 50px;
				width: 50px;
			}
			.mui-preview-image img.mui-transitioning {
				-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
				transition: transform 0.5s ease, opacity 0.5s ease;
			}
			@-webkit-keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			@-webkit-keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			@keyframes fadeOut {
				0% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}
			p img {
				max-width: 100%;
				height: auto;
			}
			#svgdiv{width: 180px;margin:  0 auto;}
		</style>
	</head>
	<body>
		<!--header star-->
	<header class="mui-bar mui-bar-nav">
			    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize"></a>
			    <h1 class="mui-title">优惠券详情</h1>  
			 
			</header>
		<script src="../../js/statusBar.js"></script><!--状态栏-->
	    <!--header end-->
	    <div id="container">		
			<div id="main">
				<!--<div class="member clearfloat box-s" id="memberList">
					<div class="list clearfloat fl box-s">
						<div class="title">
							<p class="bage">去哪儿网</p>
							<h3>20元活动券</h3>
							<div class="limit">
								<p>使用条件：满100减20</p>
								<p>可用时间：2015-5-15到2017-5-30</p>
							</div>
							
						</div>
						<div class="top clearfloat box-s">
							<div class="zuo clearfloat fl">
								<img src="../../img/tou.png"/>
							</div>
						</div>
						
					</div>
				</div>-->
			</div>
		</div>
		
		<!--渲染数据-->
		<script type="text/html" id="main-detail">
			<div class="member clearfloat box-s" id="memberList">
				<div class="list clearfloat fl box-s">
					<div class="title">
						<% if(couponList.user_coupon_state == 1){ %>
							<p class="bage">可使用</p>
						<% }else{ %>
							<p class="bage gray">已失效</p>
						<% } %>
						<h3 class="h3div">
							<%= couponList.name%>
							
						</h3>
						<div class="limit" style="-webkit-user-select:  text!important;">
							支付订单号：<%= couponList.orderUUID %> 
							有效时间：<%= couponList.begin_date %>到<%= couponList.end_date %><br />
							<%if(couponList.address){%>
								地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;址:<span style="color: #999;"><%=couponList.address%></span>
							<%}%><br />
							<%if(couponList.description){%>
								店家简介:<span style="color: #999;"><%=couponList.description%></span>
							<%}%>
						</div>
						
					</div>
					<div class="top clearfloat box-s">
						<div class="zuo clearfloat fl">
							<div class="qrcode mui-content-padded" id="svgdiv">
								<img src="" data-preview-src="" data-preview-group="1"  />
								
							</div>
						</div>
					</div>
					
				</div>
			</div>
		</script>
	</body>
	<!--图片预览-->
	<script src="../../js/mui.zoom.js"></script>
	<script src="../../js/mui.previewimage.js"></script>
	<script>
		mui.previewImage();
	</script>
	<!--模板引擎获取数据-->
	<script type="text/javascript" charset="utf-8">
      	mui.init();
		mui.plusReady(function(){
			//获取缓存
			var oldToken = plus.storage.getItem('oldToken');
			var myuserid = plus.storage.getItem('userid');
			var couponId = plus.webview.currentWebview().couponId;
			var cityNum = plus.storage.getItem('cityNum');
//			var bcouponId = plus.storage.getItem('bcouponId');
			
			mui.ajax(serverUrl+'/api/useraccount/mycoupon',{
				data:{userid: myuserid,user_coupon_id:couponId},
				dataType:'json',
				type:'post',
				timeout:5000,
				headers:{"token": oldToken,'city': cityNum},	 
				success:function(data,type,xhr){
					console.log('详情',data);
					//循环出当前优惠券Id
					for(var m=0; m < data.data.user_coupon.length; m++){
						var d = new Date();
						var str = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
						var nowdate = formatDate(str, "yyyy.MM.dd");
						var endDate = formatDate(data.data.user_coupon[m].end_date, "yyyy.MM.dd");
						if(data.data.user_coupon[m].end_date && endDate<nowdate){//判断时间过期
							data.data.user_coupon[m].user_coupon_state = 0; 
						}
						if(data.data.user_coupon[m].user_coupon_id == couponId){
							mui.each(data.data.user_coupon,function (index,element) { 
									element.coupon_amount && (element.discountstr = element.coupon_amount.split(',')[1]*10);
									element.coupon_amount && (element.discountnum = element.coupon_amount.split(',')[0]);
							}) 
//							if(data.data.user_coupon[m].salerule==null || data.data.user_coupon[m].salerule==''){
//							 	data.data.user_coupon[m].salerule=null;
//							}else{	
//								data.data.user_coupon[m].salerule1= eval("("+ data.data.user_coupon[m].salerule +")").overflowValue;
//								data.data.user_coupon[m].salerule2= eval("("+data.data.user_coupon[m].salerule+")").cutValue;
//							}
							var coupon = {};
							
							coupon.couponList = data.data.user_coupon[m]; 
							var html = template('main-detail',coupon);
							document.getElementById('main').innerHTML = html;
							mui('#svgdiv')[0].innerHTML = data.data.QrSvg;

						}
					}   


				},
				error:function(xhr,type,errorThrown){
					console.log('响应失败  !');
				}
			});
		})
    </script>
</html>
