<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>圈子详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">  
		<link rel="stylesheet" type="text/css" href="../../css/config.css" /> 
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" /> 
    	<link rel="stylesheet" type="text/css" href="../../css/config.css"/>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/mui.zoom.js"></script>
		<script src="../../js/mui.previewimage.js"></script>
		<script src="../../js/artTemplate-native.js"></script>
		 
	</head>
	<style type="text/css">
		#header>*{color:white}
		#userBox{background-color:#f53c42;padding:0;position:relative;overflow:hidden;height:calc(100vw * 0.7)}
		#mypic1{width:100%}
		#beijing2{position:absolute;z-index:1;width:100%;height:100%;top:0;background-color:rgba(0,0,0,0.5)}
		.userAvatorm{position:absolute;left:50%;width:50px;bottom:calc(100vw * 0.3);bottom:-webkit-calc(100vw * 0.3);bottom:-moz-calc(100vw * 0.3);height:50px;-webkit-transform:translateX(-50%);z-index:9;border-radius:50%}
		.idhiji{font-size:20px;font-weight:200}
		.idhiji,.personalSign{text-align: center;position:absolute;left:50%;bottom:calc(100vw * 0.4);bottom:-webkit-calc(100vw * 0.4);bottom:-moz-calc(100vw * 0.4);-webkit-transform:translateX(-50%);z-index:9;color:white} 
		.personalSign{top: calc(100vw * 0.35);top: -webkit-calc(100vw * 0.35);top: -moz-calc(100vw * 0.35);}
		.personalSign img{width: 20px;margin-left: 5px;}
		.newbop{position: absolute;left:10%; bottom:calc(100vw * 0.05);bottom:-webkit-calc(100vw * 0.05);bottom:-moz-calc(100vw * 0.05);width: 80%;color: #F3F3F3;z-index: 9;text-align: center;}
	 	.newbop button{margin: 20px}
	 	.listCon{border-bottom: 15px solid #F3F3F3;}
		.listCon p{padding:10px 0 0}
		.follow{position:relative;}
		.follow{background-color:#fff;padding:15px 10px;}
		.follow:after{position:absolute;right:10px;bottom:0;left:10px;height:1px;background:#cacaca;content:'';-webkit-transform:scaleY(.3);}
		.follow:last-child:after{height:0;}
		.fchidl{display:flex;align-items:center;justify-content:space-between;}
		.userAvator{margin-right:15px;width:2.5rem;height:2.5rem;}
		.userAvator{border-radius:50%;}
		.fchidl>div{display:flex;vertical-align:middle;text-align:left;font-size:15px;align-items:center;}
		.text{color:#999;}
  		.flexrr{display: flex;justify-content: space-around;align-items: center;padding: 10px 0;}
  		.flexrr>div img{width: 25px;vertical-align: middle;}
  		.cmtall img{width: 25px;margin-right: 5px;}
  		.cmtflex{display: flex;justify-content: space-between;align-items: center;}
  		.ctc span{color: #fb7e23;}
  		ul{list-style: none;padding: inherit;margin: 0;}
		.jubao{background-color: white;bottom: 0!important;position: absolute;right: 0;left: 0;} 
		.jubao li a{padding: 18px;line-height: 15px;text-align: center;border-bottom: 1px solid #EEEEEE;display: block;color: black;}
		.jubao li:last-child a{color: rgb(153,153,153);}
		#upload{min-height: auto !important;padding-top: 5px;height: 37px;}
		#upload img{padding: 0 !important;margin: 0;width: 32px;}
		body{padding-bottom: 0;}
		.loadPics{max-width: 80%;}
		.DTcontent{overflow: hidden;}
		.dynamicPic{float: left;position: relative;overflow: hidden;border-right: 2px solid #fff;}
		.dynamicPic1{width: 70%;padding-top: 68%;}
		.dynamicPic2{width: 50%;padding-top: 48%;}
		.dynamicPic3{width: 33%;padding-top: 31%;}
		.dynamicPic img{width: 100%;}
		.dynamicPic span{display: inline-block;position: absolute;top: 2%;left: 2%;width: 96%;height: 96%;background-color: #F3F3F3;overflow: hidden;}
		.line2{text-overflow: ellipsis;overflow: hidden;white-space: nowrap;max-width: calc(100vw * 0.45);max-width: -webkit-calc(100vw * 0.45);max-width: -moz-calc(100vw * 0.45);}	
		.maxwn{white-space: nowrap;}	
		.maxwt{flex-basis: 50px;white-space: nowrap;text-align: right;}
		#maskInfo{z-index:99999;position:fixed;top:0;left:0;width:100%;bottom:0;background-color:rgba(0,0,0,.5)}
		#upload{min-height: auto !important;padding-top: 5px;height: 37px;text-align: center;font-size: 15px;color: #777;}
		#upload img{padding: 0 !important;margin: 0;width: 32px;}
		#maskInfo{z-index:99999;position:fixed;top:0;left:0;width:100%;bottom:0;background-color:rgba(0,0,0,.5)}	
		.jubao{background-color: white;} 
		.jubao li a{padding: 18px;line-height: 15px;text-align: center;border-bottom: 1px solid #EEEEEE;display: block;color: black;}
		.jubao li:last-child a{color: rgb(153,153,153);}
	   	
	</style>

	<body style="background-color: white;">

		<header id="header" class="mui-bar mui-bar-transparent" style="padding-top: 19.5px;height: 70px;">
			<a id="leftbtn" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="centertitle" class="mui-title"></h1>
			<a href="javascript:;" style="line-height: 50px;display: none;color: #fff !important;" id="ediCircle" class="mui-pull-right ft14">编辑</a>
		</header>

	   
		<div id="main">
			<div class="clearfloat box-s box-ss" id="userBox">
	    		<img id="mypic1" class="picOp" onload="imgHeight(this)" src=""/>
	    		<div id="beijing2"></div> 
	    			<div id="nickname" class="idhiji">---</div>
	    			<div id="miaoshu" class="personalSign ft14">---</div> 
	    			<div class="newbop">
						<button type="button" class="mui-btn mui-btn-danger goask" style="padding:4px 12px!important;display: none;">发表</button>
						<button type="button" class="mui-btn mui-btn-blue goaskZ" data-id = "0" style="padding:4px 12px!important;display: none;">加入圈子</button>
						<button type="button" class="mui-btn mui-btn-blue gojh" data-id = "5" style="padding:4px 12px!important;display: none;">精华</button>
	    			</div>
	    	</div>
	    	
			
			<!--动态-->
			<div class="QandA">
				
				
				<div class="dyCon" id="dyCon0" style="display: none;"></div><!--最新动态-->

				<script type="text/html" id="listDataS">
					<%for(var i=0;i<dataList.length;i++){%>
						<%if(dataList[i].user_id && dataList[i].user_id != 'null' && dataList[i].id){%>
							<div class="listCon">
								<div class="follow">
									<div class="fchidl">
										<div onclick="elseCircleIndex(<%=dataList[i].user_id%>)">
											<img data-src="<%=dataList[i].avatar%>" src="" class="userAvator mr25 loadPics"/>
											<div>
												<%=dataList[i].nickname%> <div class="disablecl ft12"> <%=dataList[i].create_time%>  <span style="color: #5d86b2;"><%=dataList[i].read%></span>阅读 </div>
											</div>
										</div>
										<div class="butright">
											<div class="goanswer"> <img src="../../img/makeFriend/down.png" style="width:15px;"/> </div>
							           </div>
									</div>
									<div class="DTcontent" onclick="DTdetail(<%=dataList[i].id%>,<%=dataList[i].user_id%>)">
										<p  class="ft14 maincl overTwo" style="-webkit-user-select: text;"><%=dataList[i].content%> </p><!--文字内容-->
										<%if(dataList[i].picS){%>
											<%for(var j=0;j<dataList[i].picS.length;j++){%>
												<%if(dataList[i].picS.length == 1){ %>
													<div class="dynamicPic dynamicPic1">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" data-preview-src="" data-preview-group="<%=i%>"/></span>
													</div>
												<%}else if(dataList[i].picS.length == 2){%>
													<div class="dynamicPic dynamicPic2">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" data-preview-src="" data-preview-group="<%=i%>"/></span>
													</div> 
												<%}else{%>
													<div class="dynamicPic dynamicPic3">
														<span><img onload="imgHeight(this)" class="loadPics picOp" data-src="<%=dataList[i].picS[j]%>" data-preview-src="" data-preview-group="<%=i%>"/></span>
													</div>
												<%}%>	
											<%}%>
										<%}%>	
										
									</div>
									<div class="flexrr">
										<div class="disablecl ft12" >
											<%if(dataList[i].likeUserId){%>
												<img src="../../img/makeFriend/yizan.png" onclick="goZan(this,<%=dataList[i].id%>,<%=dataList[i].user_id%>)"/>
												<%}else{%>
													<img src="../../img/makeFriend/zan.png" onclick="goZan(this,<%=dataList[i].id%>,<%=dataList[i].user_id%>)"/>
													<%}%>
											 
											 赞<span><%=dataList[i].likes%></span> </div> 
										<div class="disablecl ft12" onclick="goInfoCmt(<%=dataList[i].id%>,<%=dataList[i].user_id%>,'')"> <img src="../../img/makeFriend/message.png" alt="" /> 评论 </div>
										<div class="disablecl ft12"> <img src="../../img/makeFriend/share.png"/> 转发 </div>
									</div>
									
									<div class="commentsShow" data-id="<%=dataList[i].id%>"></div>
									 
								</div> 
							</div>
							<%}%>
						
					<%}%>	
				</script>
				
				<!--评论模板-->
				<script type="text/html" id="cmtTpl">
					<div class="cmtflex" style="border-top:1px solid #DDDDDD ;border-bottom: 1px solid #DDDDDD;padding: 10px 5px;"><!--评论-->
						<div style="text-align: center;line-height: 0.8;"> 
							<div class="ft14">评论</div>
							<img style="width: 30px;margin: 0;" src="../../img/makeFriend/cmt.png"/>
						</div>
						<div class="cmtflex cmtall ft12">
							<img src="../../img/makeFriend/more.png"/>
							评论<%=allL%>
						</div>
					</div>
					<%for(var i=0;i<list.length;i++){%>
						<%if(!list[i].commontid){%>
							<div class="follow ft12" style="padding: 5px;"> 
								<div class="fchidl">
									<div class="ctc" onclick="goInfoCmt(<%=list[i].newsId%>,<%=list[i].userid%>,<%=list[i].id%>)"> <span data-id="<%=list[i].user_id%>" class="ft12 maxwn"><%=list[i].nickname%></span>：<div class="line2"><%=list[i].commont%></div></div> 
									<div class="butright maxwt"> <div class="disablecl ft12"> <%=list[i].create_time%> </div> </div> 
								</div>
							</div>
							<%}else{%>
								<div class="follow ft12" style="padding: 5px;"> 
									<div class="fchidl">
										<div class="ctc"  onclick="goInfoCmt(<%=list[i].newsId%>,<%=list[i].userid%>,<%=list[i].id%>)" style="-webkit-user-select: text;"> <span data-id="<%=list[i].user_id%>" class="ft12 maxwn"><%=list[i].nickname%></span>回复<span data-id="<%=list[i].touserid%>"class="ft12"><%=list[i].TO_nickname%></span>:<div class="line2"><%=list[i].commont%></div></div> 
										<div class="butright maxwt"> <div class="disablecl ft12"> <%=list[i].create_time%> </div> </div> 
									</div>
								</div> 
								<%}%>
						<%}%>
				
				
				</script>
				<div class="upload text-center text-xs gray" id="upload"><img src='../../img/balls.svg' /></div>
			</div>
			<!--动态结束-->
			
			
		 
		</div>
		<!--操作表-->
		<div id="maskInfo" style="display: none;">
		    <!-- 可选择菜单 -->
		    <ul class="jubao">
		      <li>
		        <a href="javascript:;" onclick="doJubao()">加入黑名单</a>
		      </li>
		      <li>
		        <a href="javascript:;" onclick="doJubao()">举报</a>
		      </li>
		      <li>
		        <a href="javscript:;" class="closeMask" >取消</a>
		      </li>
		    </ul>
		</div>
	 </body>
	 <script type="text/javascript">
		/*图片高宽处理*/
//		function imgHeight(obj){
//			if(obj.offsetHeight<obj.parentNode.offsetHeight){
//				obj.style.height = '100%';
//				obj.style.width = 'auto';
//			}
//		}
	 </script>
	 
	<script type="text/javascript">
		mui.plusReady(function(){
			var creator = plus.webview.currentWebview().creator;
	    	if(creator === '0'){//我创建的
	    		$('.goask,.gojh,#ediCircle').css('display','');
	    	}else if(creator === '1'){//我加入的
	    		$('.goask,.gojh').css('display','');
	    	}else{
	    		$('.goaskZ').css('display','');
	    	}
			
			
			var circleId = plus.webview.currentWebview().circleId,
				cityNum = plus.storage.getItem('cityNum'),
				oldToken = plus.storage.getItem('oldToken'),
			    myuserid = plus.storage.getItem('userid');
		    //编辑圈子
			$('#ediCircle').click(function(){
				openview({
					view:'editCircle.html',
					id:'editCircle',
					extrasobj: {
						circleId: circleId,
					}
				})
			})
			//发表 跳转
			$('.goask').click(function(){
				openview({
					view:'circlePublish.html',
					id:'circlePublish',
					extrasobj: {
						circleId: circleId,
					}
				})
			})
			document.addEventListener('refresh', function() {
				loadFun();
			})
			loadFun();
			/*加载头部详情*/
			function loadFun(){
				mui.ajax(serverUrl + '/api/friends/space/isSomeOne/1/id/'+circleId, {
					dataType: 'json',
					type: 'get',
					timeout: 8000,
					headers: {"token": oldToken,'city': cityNum},
					success: function(data) {
						console.error('圈子详情', data);
						if(data.errno == 0) {
							var dataObj = {};
							mui('#mypic1')[0].src = JSON.parse(data.data.picImg)[0].picImg;
							mui('#nickname')[0].innerHTML = data.data.name;
							mui('#miaoshu')[0].innerHTML = data.data.description;
							$('.goaskZ').attr('data-id',data.data.price);
						}
					},
					error: function(xhr, type, errorThrown) {
						mui.toast("当前网络不好请重试");
					}
				});
			}
			
					 
	    	//加入圈子
	    	$('.goaskZ').click(function(){
	    		if(plus.storage.getItem('myToken')){
		    		if($(this).attr('data-id')!= 0){
						mui.confirm('加入圈子需要支付'+$(this).attr('data-id')+'HI豆','提示',['取消','确定'],function(e) {
							if(e.index == 1) {
								mui.ajax(serverUrl + '/api/friends/space/', {
									data:{userId:myuserid,id:circleId},
									dataType: 'json',
									type: 'put',
									timeout: 8000,
									headers: {"token": oldToken,'city': cityNum},
									success: function(data) {
										console.error('加入圈子', data);
										if(data.errno == 0) {
											mui.toast('加入成功');
											if(plus.webview.getWebviewById('circleAll')){
												mui.fire(plus.webview.getWebviewById('circleAll'),'refresh')
											}
											$('.goaskZ').css('display','none');
			    							$('.goask,.gojh').css('display','');
										}
									},
									error: function(xhr, type, errorThrown) {
										mui.toast("当前网络不好请重试");
									}
								});
							 	
							} 
						},'div')
		    	}else{
		    			mui.ajax(serverUrl + '/api/friends/space/', {
							data:{userId:myuserid,id:circleId},
							dataType: 'json',
							type: 'put',
							timeout: 8000,
							headers: {"token": oldToken,'city': cityNum},
							success: function(data) {
								console.error('加入圈子', data);
								if(data.errno == 0) {
									mui.toast('加入成功');
									if(plus.webview.getWebviewById('circleAll')){
										mui.fire(plus.webview.getWebviewById('circleAll'),'refresh')
									}
									$('.goaskZ').css('display','none');
	    							$('.goask,.gojh').css('display','');
								}
							},
							error: function(xhr, type, errorThrown) {
								mui.toast("当前网络不好请重试");
							}
						});
		    			
		    			$(this).css('display','none');
		    			$('.goask,.gojh').css('display','');
		    		}
		    	}else{
		    		mui.toast('请登录');
					openview({
						view:'../login.html'
					});
		    	}
	    	})
			
		})
	</script>
	
	
	<script type="text/javascript">
 
		//滚动监听(head渐变)
		$(window).scroll(function() {
           var navBarHeight = 50;  
            var targetID = "#header";
            var scrollTo = $(window).scrollTop();
            if (scrollTo > navBarHeight) {
            	$(targetID).css({"box-shadow": "0 0 2px rgba(175, 166, 166, 0.85) !important"});
            	mui('#header')[0].style.boxShadow="0 0 2px rgba(175, 166, 166, 0.85)";
                $('#centertitle').html('圈子详情');
                $('#centertitle,#leftbtn,#ediCircle').css({'color':'#666'});
            } 
            if (scrollTo < navBarHeight) {
            	mui('#header')[0].style.boxShadow="0 0 0 rgba(175, 166, 166, 0.85)";
                $(targetID).css({"background-image": "none","box-shadow": "none !important"});
                $('#centertitle').html('')
                $('#centertitle,#leftbtn,#ediCircle').css({'color':'#fff'});
            } 
        }).trigger('scroll');
		 
     	
	      	
		//精华
		$('.gojh').click(function(){
			mui.plusReady(function(){
				var circleId = plus.webview.currentWebview().circleId;
				openview({
					view:'bestC.html',
					id:'bestC',
					extrasobj:{
						infoid: circleId,
					}
				})
			})
			
		})
		
		//动态详情1
		function DTdetail(id,userid){
			openview({
				view:'circleListInfo.html',
				extrasobj:{
					infoid: id,
					UserId:userid,
				}
			})
		}
	 
	</script>
	<script type="text/javascript">
			function refreshFun(){
				shopData(0,0,false);//默认推荐
			}
			mui.plusReady(function(){
				downRe(refreshFun,'30px');
			})	
			
			/*铺数据*/
			var dyCon = document.getElementsByClassName('dyCon'); /*内容盒子*/
			shopData(0,0,false);//默认推荐
			dyCon[0].style.display = 'block';
			document.addEventListener('refresh', function() {
				shopData(0,0,true);
			})
			function shopData(typeNum,gender,refresh){
				var Spagenum = 2; //实到页数
				var Ypagenum = 1; //应到页数
				mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
				mui.plusReady(function(){
					var myuserid = plus.storage.getItem('userid');
					var circleId = plus.webview.currentWebview().circleId;
					window.goInfoCmt = function(id,userid,cmtid){
		            		event.stopPropagation();
		 				if(plus.storage.getItem('myToken')){
							var cityNum = plus.storage.getItem('cityNum'); 
							var oldToken = plus.storage.getItem('oldToken');
							mui.prompt('null','请输入评论','评论',['确认','取消'],function(e) {
								if(e.index == 0) {
									if(e.value && e.value!=' '){
										var commont = e.value;
						    			mui.ajax(serverUrl + '/api/friends/newscomment', {
					    						data:{newsId:id,userid:myuserid,touserid:userid,commont:commont,commontid:cmtid},
											dataType: 'json',
											type: 'POST',
											timeout: 8000,
											headers: {"token": oldToken,'city': cityNum},
											success: function(data, type, xhr) {
												console.error('评论详情', data);
		
												if(data.errno == 0) {
									    			mui.toast('评论成功');
									    			shopData(0,0,false);
												}else{
													mui.toast('当前网络不好,请重试');
												}
											},
											error: function(xhr, type, errorThrown) {
												console.error('评论,响应失败');
												mui.toast('当前网络不好,请重试');
											}
										});
									}else{
										mui.toast('评论失败')
									}
								}
							},'')
						}else{
							mui.toast('请登录');
							openview({
								view:'../../login.html'
							});
						}
		 			}
					//到主页
					window.elseCircleIndex = function(id){
						if(id == myuserid){
							openview({
					    		view:'mycircleIndex.html',
					    		id:'mycircleIndex' 
					    	})
						}else{
							openview({
					    		view:'elsecircleIndex.html',
					    		id:'elsecircleIndex',
					    		extrasobj:{userId:id}
					    	})
						} 
				    }
					
					window.goZan = function(obj,id,toUserId){ 
						var curThis = $(obj); 
						if(curThis.attr('src') == '../../img/makeFriend/zan.png'){
							likeThis(curThis,id,toUserId,cityNum,myuserid,oldToken,'POST','../../img/makeFriend/yizan.png');
						}else{ 
							likeThis(curThis,id,toUserId,cityNum,myuserid,oldToken,'delete','../../img/makeFriend/zan.png'); 
						}
					}
					if(typeNum == 0){
						var dataJson = {
							'numsPerPage':6,
							'currentPage':1,
							'orderType':'DESC',
							'orderField':'create_time',
							'typeId':3,
							'spaceType':circleId
						}
					}
					var cityNum = plus.storage.getItem('cityNum'),oldToken = plus.storage.getItem('oldToken');
					mui.ajax(serverUrl + '/api/friends/newslist', {
						data: dataJson,
						dataType: 'json',
						type: 'post',
						timeout: 8000,
						headers: {"token": oldToken,'city': cityNum},
						success: function(data, type, xhr) {
							console.error('圈子动态', data);
							if(data.errno == 0) {
								if(data.data.data.length){
									
									var dataObj = {};
									var nowArray = data.data.data;
	
									for(var j = 0 ;j<nowArray.length;j++){
										//整理头像格式
										if(nowArray[j].avatar && nowArray[j].avatar!='null'){
											if(JSON.parse(nowArray[j].avatar)[0].picImg.indexOf('http') == -1){
												nowArray[j].avatar = serverimgUrl + JSON.parse(nowArray[j].avatar)[0].picImg;
											}else{
												nowArray[j].avatar = JSON.parse(nowArray[j].avatar)[0].picImg
											}
										}else{
											nowArray[j].avatar = '../../img/10.png'
										}
										
										if(nowArray[j].nickname && nowArray[j].nickname !='null'){
											if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(nowArray[j].nickname)){
												nowArray[j].nickname = nowArray[j].nickname.substring(0,3)+"****"+nowArray[j].nickname.substring(7,11)
											}
										}else{
											nowArray[j].nickname = '匿名'
										}
										if(!nowArray[j].read){
											nowArray[j].read = 0
										}else if((nowArray[j].read / 1000)>1){
											nowArray[j].read = parseInt(nowArray[j].read / 1000) +'K+'
										}
										if(!nowArray[j].likes || nowArray[j].likes<0){
											nowArray[j].likes = 0
										}
	//									else if((nowArray[j].likes / 1000)>1){
	//										nowArray[j].likes = parseInt(nowArray[j].likes / 1000) +'K+'
	//									}
										var dt = new Date(nowArray[j].create_time).getTime(); 
										nowArray[j].create_time = getDateDiff(dt);
										//整理内容图片格式
	 									var nowArray2 = JSON.parse(nowArray[j].pic);
										if(nowArray2.length){
											var picS = [];
											for(var k = 0 ;k<nowArray2.length;k++){
												picS.push(nowArray2[k].picImg);
											}
											nowArray[j].picS = picS;
										}
									}
									
									dataObj.dataList = data.data.data;
									document.getElementsByClassName("dyCon")[typeNum].innerHTML = template("listDataS", dataObj);
									if(data.data.data.length<6){
										mui("#upload")[0].innerHTML = "到底了";
									}else{
										mui("#upload")[0].innerHTML = "";
									}
									
									lazyLoad(true,50);//懒加载
									//操作表
									var jbuid='',junsid;
									$('.goanswer').click(function(){
										junsid = $(this).attr('data-id');
										jbuid = $(this).attr('data-useRId');  
										event.stopPropagation();
										$('#maskInfo').fadeIn(200); 
										
									})
									window.doJubao= function(){ 
										if(plus.storage.getItem('myToken')){
											jubao(junsid,jbuid,myuserid,cityNum,oldToken)
										}else{
											mui.toast('请登录');
											openview({
												view:'login.html'
											});
										} 
									}
									 
									$('#maskInfo li').click(function(){
										event.stopPropagation()
									})
									$('#maskInfo,.closeMask').click(function(){
										event.preventDefault()
										$('#maskInfo').fadeOut(200);
									}) 
									$(window).scroll(function() {
										if(document.getElementsByClassName("dyCon")[typeNum].style.display == 'block'){//判断是否是 当前显示的盒子
												var scrollTop = $(this).scrollTop();　
												if(typeNum == 0){
													SH0 = $(this).scrollTop();
												}else if(typeNum == 1){
													SH1 = $(this).scrollTop();
												}
												var scrollHeight = $(document).height();
												var windowHeight = $(this).height();　　
												if(scrollTop + windowHeight == scrollHeight) {
													if(Spagenum <= data.data.totalPages && Spagenum == Ypagenum + 1) { //当前页小于等于总页数时请求下一页
														mui("#upload")[0].innerHTML = "<img src='../../img/balls.svg' />";
														Ypagenum++; //满足加载情况,应到页数+1
														console.log('发起请求,实到' + Spagenum + '页');
														console.log('发起请求,应到' + Ypagenum + '页');
														if(typeNum == 0){
															var dataJson = {
																'numsPerPage':6,
																'currentPage':Spagenum,
																'orderType':'DESC',
																'orderField':'create_time',
																'typeId':3,
																'spaceType':circleId 
															}
														}
														mui.ajax(serverUrl + '/api/friends/newslist', {
															data: dataJson,
															dataType: 'json',
															type: 'post',
															timeout: 8000,
															headers: {"token": oldToken,'city': cityNum},
															success: function(data) {
																console.error('圈子动态续'+typeNum, data);
																if(data.errno == 0) {
																	var dataObj = {};
																	var nowArray = data.data.data;
																	for(var j = 0 ;j<nowArray.length;j++){
																		//整理头像格式
																		if(nowArray[j].avatar && nowArray[j].avatar!='null'){
																			if(JSON.parse(nowArray[j].avatar)[0].picImg.indexOf('http') == -1){
																				nowArray[j].avatar = serverimgUrl + JSON.parse(nowArray[j].avatar)[0].picImg;
																			}else{
																				nowArray[j].avatar = JSON.parse(nowArray[j].avatar)[0].picImg
																			}
																		}else{
																			nowArray[j].avatar = '../../img/10.png'
																		}
																		
																		if(nowArray[j].nickname && nowArray[j].nickname !='null'){
																			if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(nowArray[j].nickname)){
																				nowArray[j].nickname = nowArray[j].nickname.substring(0,3)+"****"+nowArray[j].nickname.substring(7,11)
																			}
																		}else{
																			nowArray[j].nickname = '匿名'
																		}
																		if(!nowArray[j].read){
																			nowArray[j].read = 0
																		}else if((nowArray[j].read / 1000)>1){
																			nowArray[j].read = parseInt(nowArray[j].read / 1000) +'K+'
																		}
																		if(!nowArray[j].likes || nowArray[j].likes<0){
																			nowArray[j].likes = 0
																		}
																		var dt = new Date(nowArray[j].create_time).getTime(); 
																		nowArray[j].create_time = getDateDiff(dt);
																		/*整理内容图片格式*/
																		var nowArray2 = JSON.parse(nowArray[j].pic);
																		if(nowArray2.length){
																			var picS = [];
																			for(var k = 0 ;k<nowArray2.length;k++){
																				picS.push(nowArray2[k].picImg);
																			}
																			nowArray[j].picS = picS;
																		}
																	}
																	dataObj.dataList = data.data.data;
																	document.getElementsByClassName("dyCon")[typeNum].innerHTML += template("listDataS", dataObj);
																	lazyLoad(false,50);//懒加载
																	//操作表
																	var jbuid='',junsid;
																	$('.goanswer').click(function(){
																		junsid = $(this).attr('data-id');
																		jbuid = $(this).attr('data-useRId'); 
																		event.stopPropagation();
																		$('#maskInfo').fadeIn(200); 
																		
																	})
																	window.doJubao= function(){ 
																		if(plus.storage.getItem('myToken')){
																			jubao(junsid,jbuid,myuserid,cityNum,oldToken)
																		}else{
																			mui.toast('请登录');
																			openview({
																				view:'login.html'
																			});
																		} 
																	}
																	 
																	$('#maskInfo li').click(function(){
																		event.stopPropagation()
																	})
																	$('#maskInfo,.closeMask').click(function(){
																		event.preventDefault()
																		$('#maskInfo').fadeOut(200);
																	}) 
																}
																mui("#upload")[0].innerHTML = " ";
																Spagenum++; //加载成功,当前页+1
																console.log('成功+1,实到' + Spagenum);
																console.log('成功+1,应到' + Spagenum);
															},
															error: function(xhr, type, errorThrown) {
																Ypagenum--; //失败是应到-1
																mui.toast("当前网络不好请重试");
																mui("#upload")[0].innerHTML = "";
															}
														});
													} else if(Spagenum == data.data.totalPages + 1) { //当前页不小于等于总页数时请求下一页
														//mui.toast('没有更多了');
													}
												} 
										}
									});
									
									
									//评论数据
									$('.commentsShow').each(function(){
										var newsId= $(this).attr('data-id');
										var curShow = $(this);
										mui.ajax(serverUrl + '/api/friends/newscomment/newsId/'+newsId, {
											dataType: 'json',
											type: 'get',
											timeout: 8000,
											headers: {"token": oldToken,'city': cityNum},
											success: function(data, type, xhr) {
												//console.error('评论详情', data);
												if(data.errno == 0) {
													var cmtArray = data.data;
													var newCmt = []
													if(cmtArray && cmtArray.length>0){
														if(cmtArray.length >3){
															for(var i = 0;i<3;i++){
																 
																if(cmtArray[i].nickname && cmtArray[i].nickname !='null'){
																	if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].nickname)){
																		cmtArray[i].nickname = cmtArray[i].nickname.substring(0,3)+"****"+cmtArray[i].nickname.substring(7,11)
																	}
																}else{
																	cmtArray[i].nickname = '匿名'
																}
																if(!cmtArray[i].TO_nickname){ 
																	cmtArray[i].TO_nickname =  '匿名'
																}else{
																	if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].TO_nickname)){
																		cmtArray[i].TO_nickname = cmtArray[i].TO_nickname.substring(0,3)+"****"+cmtArray[i].TO_nickname.substring(7,11)
																	}
																}
																var dt = new Date(cmtArray[i].create_time).getTime(); 
																cmtArray[i].create_time = getDateDiff(dt);
																newCmt.push(cmtArray[i])
															} 
														}else{
															for(var i = 0;i<cmtArray.length;i++){
																if(cmtArray[i].nickname && cmtArray[i].nickname !='null'){
																	if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].nickname)){
																		cmtArray[i].nickname = cmtArray[i].nickname.substring(0,3)+"****"+cmtArray[i].nickname.substring(7,11)
																	}
																}else{
																	cmtArray[i].nickname = '匿名'
																}
																if(!cmtArray[i].TO_nickname){ 
																	cmtArray[i].TO_nickname =  '匿名'
																}else{
																	if(/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(cmtArray[i].TO_nickname)){
																		cmtArray[i].TO_nickname = cmtArray[i].TO_nickname.substring(0,3)+"****"+cmtArray[i].TO_nickname.substring(7,11)
																	}
																}
																var dt = new Date(cmtArray[i].create_time).getTime(); 
																cmtArray[i].create_time = getDateDiff(dt);
																newCmt.push(cmtArray[i])
															} 
														}
														
														curShow.html(template('cmtTpl',{list:newCmt,allL:cmtArray.length}))
													}
													
												 
												}else{
													mui.toast('当前网络不好,请重试');
												}
											},
											error: function(xhr, type, errorThrown) {
												console.error('评论列表,响应失败');
												mui.toast('当前网络不好,请重试');
											}
										});
									})
								}else{/*没有数据*/
									mui("#upload")[0].innerHTML = "没有动态";
								}
							}else{
								mui.toast('当前网络不好,请重试');
							}
						},
						error: function(xhr, type, errorThrown) {
							console.error('交友列表,响应失败');
							mui.toast('当前网络不好,请重试');
						}
					});
					
				})
				
			}
			
			//发布时间判断 
			var minute = 1000 * 60;
			var hour = minute * 60;
			var day = hour * 24;
			var halfamonth = day * 15;
			var month = day * 30;
			function getDateDiff(dateTimeStamp){ 
				var now = new Date().getTime(); 
				var diffValue = now - dateTimeStamp; 
				var monthC =diffValue/month;
				var weekC =diffValue/(7*day);
				var dayC =diffValue/day;
				var hourC =diffValue/hour;
				var minC =diffValue/minute;
				if(monthC>=1){
				 result=parseInt(monthC) + "月前";
				 }
				 else if(weekC>=1){
				 result=parseInt(weekC) + "周前";
				 }
				 else if(dayC>=1){
				 result=parseInt(dayC) +"天前";
				 }
				 else if(hourC>=1){
				 result=parseInt(hourC) +"小时前";
				 }
				 else if(minC>=1){
				 result=parseInt(minC) +"分钟前";
				 }else{ 
				 result="刚刚";
				 }
				return result;
			}
			mui.previewImage();
		
		</script>


</html>